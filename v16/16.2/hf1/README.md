## 4D v16.2 Hotfix 1

![jp](https://cloud.githubusercontent.com/assets/10509075/16182979/016305e0-36e7-11e6-816b-2335cc6f0abb.png)

* ACI0095659 Mac版のみ。アプリケーション名にシングルクオート（アポストロフィ）記号が含まれている場合，``SET UPDATE FOLDER``および``RESTART 4D``による自動アップグレードが完了できませんでした。ログファイルを確認すると，更新されたアプリケーションの起動（``open -a``コマンド）に失敗していることがわかります。

* ACI0097262 テキストフィールドの保存オプションを「データファイルの外」に設定した場合，マルチバイト文字がテキストの259バイト目に出現すると，後続の文字列がレコード保存時に失われました。

* ACI0092847 Mac版のみ。スタティックテキストが日本語で始まる場合，フォームエディター上で``2``ピクセルほどベースラインの位置が高く表示されました。文字列が英数字で始まる場合は問題ありません。エディター上とランタイムで位置が違うために，レイアウトの設計が面倒です。

**注記**: フォームエディターのスタティックテキスト（文字列が日本語で始まる場合）およびランタイムのリストボックス（最終行あるいは唯一の行が日本語のみで構成される場合）の処理が修正されています。

* ACI0097082 Windows 7のみ。複数行ではないテキスト入力エリアに表示された文字列の最後の文字がスペース（全角または半角）だった場合，小さなドット（文字と同じ色で，``¬``の左端だけがみえるような状態）が表示されました。フォントが「MSゴシック」の場合に限ります。また，上位のWindowsでは発生しません。

* ACI0096892 インポートダイアログ経由で``Windows-31J``または``Shift_JIS``エンコーディングのタブ区切りテキストファイルをインポートした場合，``tab``記号がフィールド区切り文字として処理されませんでした。

* ACI0095298 IMEの日本語変換候補ウィンドウが表示された状態でコンボボックスのポップアップメニューを表示した場合，入力中の日本語変換が確定されず，候補ウィンドウと同時にポップアップメニューも表示されました。

* ACI0093293 Mac版のみ。メソッドエディターのツールバーに統合されている検索フィールドの履歴ボタンをクリックしても，過去の実行した検索のポップアップメニューが表示されませんでした。

* ACI0094675 3Dボタン・3Dラジオボタン・3Dチェックボックスをストラクチャ間でコピーした場合，オブジェクトは複製されますが，アイコンのリソース画像は複製されませんでした。

* ACI0097314 Windows版のみ。Microsoft XPS Writerプリンターで印刷中にキャンセルボタンをクリックすると，プリントジョブを開始できない，というダイアログが表示されますが，そのダイアログを閉じても印刷の進捗が表示され，中止ボタンをクリックしても，印刷を止めることができませんでした。印刷を中止するためには，アプリケーションを強制的に中止しなければなりません。

* ACI0097264 ``On Outside Call``イベントで``ACCEPT``コマンドを使用した場合，すぐにはフォームが閉じられず，次に発生したイベントで閉じられませんでした。

* ACI0097124 4D Server Windows 64ビット版のみ。新規データベースを作成すると，エラー``1010``が返されました。``MECAB.DLL``がインストールされていないためです。

* ACI0094424 メソッド名の30文字目が日本語だった場合，そのメソッドを複製すると同じ名前のメソッドが作成されました。

---

* ACI0097120 64ビット版のみ。クイックレポートで日付フィールドに対して``Min``または``Max``関数を使用した場合，日付ではな数値が返されました。

* ACI0097352 Windows版のみ。ペーストボード内にSVGピクチャーがセットされている場合，終了時にアプリケーションがクラッシュしました。SVG以外の画像フォーマットであれば問題ありません。終了前にペーストボードをクリアすれば，クラッシュしません。

* ACI0097456 Windows版のみ。ポップアップウィンドウ（``32``）の外部をクリックしてウィンドウを閉じた場合，入力中だった文字列が確定されずにキャンセルされました。``Get edited text``には値が正しく返されます。

* ACI0097411 4D Writeから変換した4D Write Pro文書は「スモールキャピタル（小文字と同じ高さの大文字）」スタイル指定が継承されませんでした。

* ACI0096775 ``On Exit``データベースメソッドの中で``TRACE``が使用された場合，``On Exit``が実行されませんでした。

* ACI0097370 新ネットワークレイヤーのみ。イーサネットケーブルが引き抜かれるなど，クライアント接続が不意に失われた場合， ``On Server Close Connection``データベースメソッドが実行されませんでした。

* ACI0097369 デフォルト名前空間のURIが含まれるXML文書を``DOM Parse XML Source``で解析しようとすると，エラー`` -9935``が返されました。

* ACI0097257 ユーザー/グループ認証システムが設定されているアプリケーションで，ユーザー名とパスワードの入力画面でログイン操作を完了せずにネットワークから離れた場合，無名のユーザープロセスがサーバー側に残されました。たとえば，ログイン画面を表示したまま，ノートパソコンを閉じて別の場所に移動し，操作を再開した場合に問題が発生します。そのままログインした場合，サーバー側に無名のユーザーと有効なユーザーの両方が存在することになり，余分にクライアント接続ライセンスが消費されました。新旧どちらのネットワークレイヤーでも問題が発生しますが，旧ネットワークレイヤーであれば，クライアント/サーバー接続タイムアウトまで待てば無名のユーザーが消滅します。新ネットワークレイヤーでは，無名のユーザーはドロップすることができず，状況を是正するためにはサーバーを再起動するしかありません。

**注記**: 修正により，無名のユーザー（ログインを完了しなかった場合に発生）や重複するユーザー（ログイン後にネットワーク接続が失われた場合に発生）がサーバー管理画面でドロップできるようになりました。16 R5以降であれば，そのようなユーザー（いわゆるゾンビユーザー）は，同じクライアントからサーバーに接続したタイミングで自動的に消滅します。また，v16.xであっても，クライアントとのネットワーク通信が途絶えてから2時間が経過すれば，やはり自動的に消滅します。

* ACI0096533 4D Viewのセルにカスタムフォーマット（例：``£###.###.##0,00``）を設定することができませんでした。

* ACI0097369 デフォルト名前空間のURIが含まれるXML文書を``DOM Parse XML Source``で解析しようとすると，エラー`` -9935``が返されました。

* ACI0097338 Windows版のみ。32ビット版のサーバーに接続した直後にクエリを実行すると，アプリケーションがクラッシュしました。

* ACI0097322 Mac 64ビット版のみ。Unlimited Desktopでビルドしたアプリケーションでは，``GRAPH``コマンドから常に空の画像を返されました。

**注記**: ``GraphTemplates``フォルダーがパッケージのリソースにコピーされていないことが原因です。

* ACI0096801 サブフォームウィジェットの水平リサイズオプションが「拡大」に設定されている場合，``On Load``イベント中にウィジェット内のオブジェクトを移動すると，``OBJECT SET COORDINATES``から返される位置情報が正しくありませんでした。実際の位置にフォームのリサイズされた幅を加算した値が返されました。``On Timer``イベントであれば問題ありません。

* ACI0097233 Windows版のシステムWebエリアのみ。``On URL Filtering``イベント内で``WA EXECUTE JAVASCRIPT FUNCTION``コマンドを使用し，``window.location.href="http://..."``のようなJavaScriptを実行した場合，2回目の``On URL Filtering``イベントが発生しませんでした。

* ACI0097065 ``SMTP_QuickSend``コマンドをコンパイルモードで実行するたびにメモリーリークが発生しました。

* ACI0097021 ラジオボタンのプロパティで表示オプションにインタープロセス変数を使用（例：``:<>RessFormulaire,1``）すると，フォームを実行したときにボタンがチェックボックスとして表示されました。``:16000,1``のような指定であれば問題ありません。リソースは``.lproj``フォルダー内のXLIFFファイルに保存されています。

* ACI0097341 クライアント側でユーザー認証ダイアログ（ログイン画面）をキャンセルすると，サーバー側のユーザーリストに無名の接続が残され，接続ライセンス数が消費されたままになりました。

* ACI0096646 HTTPサーバーとHTTPクライアントを併用した場合，HTTPクライアントの速度が遅くなりました。

* ACI0096165 Windows版のみ。英語版のオペレーションシステムで地域と言語を「トルコ語」に設定した場合，サーバー管理画面のボタンがクリックに反応しませんでした。

**注記**: トルコ語では，「大文字と小文字を区別しない」文字列比較であっても，大文字の``I``と小文字の``i``が区別されます。サーバーの管理画面には``MONI``というフォームオブジェクトがあり，これを``moni``という文字列では参照できないことが関係しています。こうした問題はアプリケーション全般で起こり得るので，英語版のWIndowsをトルコ語の設定で使用することは避けるようにしてください。

* ACI0094836 日付型の変数を日付入力ウィジェットに関連付けた場合，フォームを開く前にセットされていた変数の値がフォームを実行すると初期化されました。

* ACI0097353 クライアント側でレコードを開いた状態で，サーバー側のネットワークケーブルを外し，ユーザーリストからクライアントが消えるまで待ってからケーブルを再接続し，クライアント側で別のレコードをロードしようとすると，アプリケーションがフリーズしました。

* ACI0097297 コンパイルモードでは，変数名にフィールドが設定されているポップアップメニューやコンボボックスのオブジェクトメソッドが実行されませんでした。単純な変数名では問題ありません。

* ACI0097278 Mac版のみ。選択リストが関連づけられたリストボックス列にタブ移動して上矢印キーでポップアップメニューを表示し，``return``キーでリスト項目を確定した場合，以後，その項目が変更できなくなりました。下矢印キーでは問題ありません。

* ACI0097241 32ビット版のみ。``WA Evaluate javascript``で``JQuery``コマンドを実行すると，コールスタックの最大数に達した，というエラーメッセージが返されました。

**注記**: JavaScriptのオブジェクトが返された場合，4DはこれをJSON（オブジェクトまたはテキスト）にシリアライズしますが，``JQuery``から返されたDOMオブジェクトなど，これが無限に再帰的な式となることがあります。そのような式は無限に評価されないよう修正されましたが，パフォーマンスを意識するのであれば，4D内では役に立たないDOMオブジェクトではなく，真偽値などを返すように心がけてください。

* ACI0096695Mac 64ビット版のみ。``On Load``イベントで``DIALOG``コマンドを使用すると，画面が再描画でちらつきました。

**注記**: ``DIALOG``を連続コールした場合に問題が発します。修正により，``On Load``のイベント処理中は，``0.2``秒ほどしてからウィンドウが再描画されるようになりました。つまり，``On Load``のイベントに``0.2``秒以上を要すると，やはり画面がちらつくように再描画されることになります。そのような場合は``On Load``や``DIALOG``の使い方を見直したほうが良いでしょう。

* ACI0097135 特定の条件下では，``SVG Find element IDs by rect``がSVG要素IDの配列を返しませんでした。

* ACI0097253 ``POP3_SetPrefs``に渡したパス名にウムラウト記号が含まれていると，エラー``-120``が返されました。

* ACI0097119 Mac 64ビット版のみ。ストラクチャエディター上でリレーションを設定する場合，描画中に水平スクロールが発生すると，アプリケーションがクラッシュしました。

* ACI0096028 クライアント/サーバー版のみ。クライアント側でSQLの``INSERT``文で``ARRAY BLOB``をフィールドに代入しようとすると，エラー``1111``が返されました。

* ACI0096026 クライアント/サーバー版のみ。クライアント側でSQLの``INSERT``文で``ARRAY TIME``をフィールドに代入しようとすると，エラー``1013``が返されました。

* ACI0096957 メソッドエディター上で改行されたコードの行末にある``\``記号の位置で``return``キーを入力すると，改行されたコード全体が``\``記号で終わる1行にまとめられました。

* ACI0096836 Mac 64ビット版のみ。「定義を開く」コマンドで指定したプロジェクトメソッドがすでにDock内に最小化されていた場合，メソッドのウィンドウが最大化されませんでした。

* ACI0097236 ツールボックスの「リスト」ページを開くと，リストの参照番号が``1``から振り直されることがありました。

* ACI0097179 ピクチャフィールドの保存先が「データファイルの外」に設定されており，トリガで``SET EXTERNAL DATA PATH``および``WRITE PICTURE FILE``でカスタムパスにファイルが書き出されている場合，クライアントで更新されたフィールドの内容がサーバーを再起動するまで別のクライアントでは表示されませんでした。

* ACI0096950 ``FTP_Send``コマンドで``2.3``GBを超えるファイルを送信することができませんでした。

* ACI0096812 クライアント側で接続の切断エラーが検出された場合，「リクエストの送信中に深刻なエラーが発生した」という大袈裟なエラーメッセージが表示されました。再接続が必要なだけであり，深刻なことは何もないはずです。

* ACI0097201 Mac版のみ。SQLの``SELECT``コマンドに``ORDER BY``が指定された場合，あるいはサーバー/クライアントモードで``INTO``が使用された場合，メモリーリークが発生しました。

* ACI0097295 Windows版のみ。サービスとして起動された4D Server上で``ALERT``のようなダイアログ表示コマンドを使用したり，範囲チェックエラー（ダイアログの表示を抑制することができない）が返されたりすると，サーバーがブロックされたようになりました。「デスクトップとの対話」が無効にされたサービスの場合，サーバー側ではダイアログの表示が全面的に回避されるべきです。

* ACI0097248 Mac版のみ。ボタンのクリックでフォームのページを切り替えると，すべてのフィールドにカーソルが表示されました。

* ACI0097219 Mac 64ビット版のみ。``On Load``フォームイベント中に``ERASE WINDOW``, ``GOTO XY``, ``MESSAGE``コマンドを実行すると，アプリケーションがクラッシュしました。

* ACI0097096 リストボックスのセルに入力中，他のウィンドウをアクティブにしてから当初のウィンドウに戻った場合，編集中のセルに入力を続けることができますが，カーソルが表示されませんでした。

* ACI0097083 非表示フィールドが存在するテーブルのフィールドに``SET FIELD TITLES``でバーチャル名を設定されている場合，4D Write文書にフィールド参照を挿入すると，意図したのではないフィールドが参照されました。

* ACI0097003 リストボックスの列には，選択リストを関連付けることができますが，時間型フィールドの場合，リスト上で選択した値が正しく代入されませんでした。たとえば`` 12:00:00``のような項目を選択すると``00:02:00``が代入され，``13:00:00``のような項目を選択すると``00:02:10``が代入されました。

* ACI0096277 Mac版のみ。4D Write Pro文書のインデント後，左マージンの手前に挿入されたタブは無視されました。つまり，``tab``キーを押しても，その位置に挿入ポイントがセットされず，左マージンまで移動しました。

* ACI0096998 データベースに数百個のテーブルが存在する場合，``Begin SQL``/``End SQL``ブロック内で``SELECT``など，テーブル名が続くコマンドを入力すると，キーストロークの動作がとても重くなりました。

* ACI0096943 リストボックスの幅に表示が収まらない列が出現するよう，水平方向に少しだけスクロールし，そのセルを編集した後，別のセルをクリックすると，リストボックスの水平スクロール位置が左いっぱいまで戻されました。クリックした列は完全に表示されているので，この場面で水平スクロールは不要なはずです。

* ACI0096875 メソッドエディター上の空行を選択した状態で``command``+``K``のキーボードショートカットを入力しても，エクスプローラーの「メソッド」ページが開きませんでした。

**注記**: 問題は，「ファイル > 開く > メソッド」および「メソッド > 定義を開く」のメニューに同じキーボードショートカットが設定されていることでした。v15以前の動作を再現するため，メソッドエディターの「定義を開く」メニューはいつでも実行できるようになり，また，空行が選択された状態で実行された場合にはエクスプローラーの「メソッド」ページを開くように内部的な仕組みが変更されました。

* ACI0097055 ビルドされたサーバーアプリケーションのデータファイルと同じ階層（``Server Database``フォルダー）にユーザー設定を置いた場合，キャッシュサイズの設定を変更しても，再起動後にカスタム設定が反映されませんでした。

* ACI0097302 64ビット版のみ。``MSG_GetBody``および``MSG_Extract``は，メールの解析に32ビット版よりもずっと長い処理時間を要しました。

* ACI0097208 Mac 32ビット版のみ。クライアント側でデザインモードにアクセスし，エクスプローラーのホームタブでサブフォルダーを作成すると，アプリケーションがクラッシュしました。最上位のフォルダーを作成した場合は問題ありません。また，シングルユーザー版でも発生しません。

* ACI0097316 Windows 10のみ。ネットワークドライブ上にインストールされた4Dを起動すると，アプリケーションがクラッシュしました。

* ACI0097408 Mac版のみ。AreaList Proプラグインエリアがフォーカスされている状況で，同にフォームに存在するテキスト入力オブジェクトをクリックしても，フォーカスが移動しませんでした。もう1回，そのオブジェクトをクリックすることが必要です。

* ACI0097357 ツールボックスのリソースタブ上でSVG画像が正常にレンダリングされないことがありました。一部のプロパティが無視されているためです。

* ACI0097282 SQLの``SELECT``文で時間型フィールドをテキストに``CAST``すると，該当する時間がミリ秒で返されました。たとえば，午前1時（``01:00``）に対し，``3600000``	が返されました。期待されるのは，以前のバージョンのように，``0:1:0:0``が返されることです。

* ACI0097210
Mac 32ビット版のみ。旧式ネットワークレイヤーでサーバーに接続した場合，4D RemoteのPU使用率がすぐに100%に達し，その後，常時80%前後をキープしました。サーバー側でもかなり高い数値がみられます。新ネットワークレイヤー，または64ビット版クライアントであれば問題ありません。

* ACI0097176 並び替えダイアログの右側フィールド順序のドラッグ＆ドロップによる変更ができませんでした。

* ACI0096615 トランザクション中にインデックスの削除や作成を実行すると，データ書き込みのタイミングでアプリケーションがクラッシュしました。

* ACI0097354 Windows版のみ。ディスプレイ解像度が異なる環境でストラクチャを開閉した場合，ウィンドウ位置を記録したJSONファイルに範囲外の座標（たとえば負の値）が書き込まれ，結果的に4DのMDIウィンドウにアクセスできなくなることがありました。

* ACI0097321 セレクション型のリストボックスをストラクチャ間でコピーした場合，コピー先でフィールド参照が失われました。テーブル数が1個であり，リストボックスの列に設定されているのがそのテーブルであれば，フィールドの参照もコピーすることができます。しかし，テーブル数が2個以上であり，2個目のテーブルがリストボックスの列に設定されている場合，フィールドの参照が列と一緒にコピーされません。

* ACI0097495 メソッドエディターの階層を展開・収縮するノードアイコンを非表示に設定した場合，アイコンにマウスポインターを重ねて``option``キーを押すとアプリケーションがクラッシュしました。

* ACI0095136 メソッドエディターで``Case of``構文の``Else``や``:``などの中間ブロックにコードをタイプ入力しようとすると，アプリケーションがクラッシュしました。挿入位置直前（上部）の条件ブロックが畳まれている場合に問題が発生します。``If``構文の条件が畳まれた状態で``Else``ブロックを編集しようとした場合にも同じ問題が発生します。

* ACI0094994 SQLのサブクエリを実行すると，サーバーがしばらく応答しませんでした。

**注記**: 内側の``SELECT``で数万件のレコードが合致した場合，``QUERY WITH ARRAY``のようなインデックス検索ではなく，シーケンシャル検索がテーブル全体に対して何度も実行されていることが原因でした。
