4D v16.0
---

* ACI0066193 ``LOG EVENT``に``Into 4D Commands Log``オプションを渡してコメントをシステムログに書き込んだ場合，日本語が化けました。

* ACI0095487 v13で作成したラベルをv15で出力すると，フィールドやスタティックテキストの位置が左上にずれました。

* ACI0095503 Mac/32ビット版のみ。フォームエディターのプロパティリストでフォント名のコンボボックスを上下矢印キーで操作した後，``enter``キーで確定すると，アプリケーションがクラッシュしました。新規オブジェクトでは問題ありません。既存のオブジェクトだけで問題が再現します。

* ACI0095505 Windows版のみ。リストフォームに表示されたフィールドの整列を「右揃え」に設定した場合，幅に収まりきらないテキストが切り捨てられる代わりに，エリアの外に表示されました。

* ACI0095562 Mac版のみ。4DがへルプTipsを表示している間に別のウインドウを最前面に移動した場合，Tipsがすぐに消えませんでした。

* ACI0095574 Mac版のみ。ドラッグ＆ドロップ操作でピクチャを入力した場合，PICT形式で画像が保存されました。画像ファイルではなく，たとえばWebブラウザなどから画像を直接のドラッグ＆ドロップした場合に問題が再現します。

**注記**: PICT形式のサポートは廃止予定です。Cocoa（64ビット）版の4Dや「プレビュー」アプリケーションは，PICT形式の画像を表示することができません。

* ACI0087565 Mac版のみ。無効なコマンド名が``LAUNCH EXTERNAL PROCESS``に渡された場合，``OK``システム変数が``0``にセットされませんでした。

* ACI0088141 ストラクチャエディターのインデックスエクスプローラー画面で，矢印キーを使用してフィールドの順番を変更すると，エラー``-20001``（配列の範囲チェック）が返されました。

* ACI0091205 ``MAXINT``を超える行番号で[SAX Get XML node](http://doc.4d.com/4dv15r/help/command/ja/page860.html)のエラーが発生した場合，[GET LAST ERROR STACK](http://doc.4d.com/4dv15r/help/command/ja/page1015.html)に負の行番号が返されました。

* ACI0091264 ``String``で``ISO Date GMT``フォーマットに日付と時間を変換した場合，夏時間（フランスでは3月29日の早朝3時から実施）を反映しませんでした。以前のプラグイン``AP Timestamp to GMT``では問題ありませんでした。

* ACI0091810 フォームエディターでリストボックスの列を複製し，``command+Z``で取り消した直後の再描画が崩れていました。

* ACI0092274 [ON EVENT CALL](http://doc.4d.com/4dv15r/help/command/ja/page190.html)を中止する（イベントマネージャープロセスを通常にプロセスに切り替える）ためのキーコンビネーション（Windows版は``Control``+``Shift``+``Backspace`` Mac版は``command``+``shift``+``control``+``backspace``）が効きませんでした。

* ACI0092571 [ユーザー設定](http://doc.4d.com/4Dv15R5/4D/15-R5/Using-user-settings.300-2964123.ja.html)が使用されている場合，アップグレード後に互換性オプションの「旧ネットワークレイヤーを使用する」が解除されました。

* ACI0093999 Mac版のみ。4D Writeにテキストを入力すると，カーソルが消えました。マウスを動かすと再びカーソルが表示されました。

* ACI0095653 4D Viewエリアのプロパティリストに[詳細設定](http://doc.4d.com/4Dv15R4/4D/15-R4/Plug-in-areas.300-2880332.ja.html)ボタンが表示されませんでした。

* ACI0095790 MacOS 10.11のみ。アプリケーションプロセスから起動したクイックレポートの出力先をHTMLまたはテキストファイルに設定した場合，クイックレポートのウインドウを閉じた後もグレーアウトされたウインドウが画面上に残されました。

* ACI0095726 Webサービスウィザードが生成するコードは，廃止予定コマンドである``_o_C_STRING``を含んでいました。

* ACI0095695 既存のフォームと同じ名前でフォームを作成しようとしたときに表示されるエラーメッセージの内容が間違っていました。

* ACI0095359 ラジオボタンをクリックすると，イベントが発生しませんでした。チェックボックスでは問題ありません。

* ACI0095354 フォームウィザートを使用して印刷用リストフォームを作成すると，ストラクチャに問題が発生しました。MSCの検査ではオブジェクト名の重複が報告され，``METHOD GET PATH``は``-9802``エラーを返します。

* ACI0095321 [MODIFY SELECTION](http://doc.4d.com/4Dv15/4D/15.1/MODIFY-SELECTION.301-2684948.ja.html)で実行されたフォームが表示されている間は，ヘルプメニューが動きませんでした。

* ACI0095286 クイックレポートの列フィールドに``###,###,###,##0.00``のようなフォーマットを設定した場合，HTML出力でフィールドの値ではなく，タイトルにフォーマットが適用されました。

* ACI0095271 Mac版のみ。リストボックスの行が選択された状態でフォーカスを移動すると，テキストの色が白のまま，背景色だけがグレーに変化しました。

* ACI0095265 ``DESCRIBE QUERY EXECUTION``を宣言してから，複数のクエリを実行した場合，``Get last query plan``と``Get last query path``は最初に実行したクエリに関する情報を返しました。コマンドは最後に実行したクエリに関する情報を返すはずです。

* ACI0095250 トランザクション中，保存場所が「データファイルの外」に設定されているピクチャーフィールドに画像を代入して新規レコードを保存し，トランザクション中にアンロード/ロードした場合，画像がロードされませんでした。トランザクションを確定した後でなければ，画像をロードすることができませんでした。

* ACI0095211 コンボボックスにタイプ入力中，完全に一致するアイテムがない限り，項目が選択されませんでした。以前のバージョンでは，前方一致した最初のアイテムが選択され，途中でEnterキーを入力すれば入力中のテキストが補完されました。

* ACI0095129 非常に負荷がかかった状態では，稀に[New log file](http://doc.4d.com/4dv15r/help/command/ja/page926.html)の実行中にレコード作成のオペレーションがログファイルに記録されないことがありました。

* ACI0095085 4D Serverのシャットダウン画面で「キャンセル」ボタンをクリックすると，サーバーは動き続きますが，接続中のクライアントは接続が切断され，新規接続はできなくなりました。

* ACI0095042 ``Dec``から正しい値が返されないケースありました。

```
Dec( (1/105000)*105000) // 0ではなく1が返される
```

**注記**: 修正により，``Dec``は限りなく``+/-1``に近い値の整数部を返すようになりました。


* ACI0094978 サポートされないSQL（CASE...WHEN...）でビューを作成しようとすると，アプリケーションがクラッシュしました。


* ACI0094901 16桁の数値に対して``Mod``でモジューロを求めると，負の値が返されました。PHPであれば問題ありません。

```
nb:="0429429886111400"
ALERT(String(Mod(Num(nb);97)))
// BUG => -41

$result:=PHP Execute("";"bcmod";$T_Resultat;nb;"97")
ALERT($T_Resultat)
// OK => 56
```

**注記**: [ドキュメント](http://doc.4d.com/4Dv15/4D/15.1/Mod.301-2685791.ja.html)に述べられているように，(2^31を超える) おおきな実数に対してModを使用する場合には注意が必要です。

* ACI0095627  標準テキスト入力からコピーしたテキストをスタイル付きテキスト入力にペーストすると，標準テキストのスタイルで文字列が挿入されました。期待されるのは，ペースト先のスタイルが継承されることです。

* ACI0095305 Windows版のみ。別々のフォームページに4D Writeと4D Webエリアをそれぞれ配置し，ページを切り替えると，4D Writeにテキストを入力することができなくなりました。

* ACI0094700 エクスプローラーの「ホーム」タブでメソッドをわずかでもドラッグすると，階層のトップレベルに移動しました。軽くクリックしただけのつもりでも，マウスポインターが少しでも移動しれば，メソッドが移動してしまいました。

* ACI0094484 テキスト入力エリアのボーダースタイルが標準（``Plain (1)``）に設定されていた場合，ボーダーの色はフォントカラーを踏襲せず，常にブラックでした。フォームエディター上は問題ありません。ランタイムの問題です。

* ACI0094154 [Select folder](http://doc.4d.com/4dv15r/help/command/ja/page670.html)は，指定されたフォルダーを選択するコマンドですが，階層に多数のフォルダーが存在する場合，目的のフォルダーまでリストをスクロールしませんでした。v2004以来の不具合です。

**注記**: これは[Windows](https://connect.microsoft.com/VisualStudio/feedback/details/518103/bffm-setselection-does-not-work-with-shbrowseforfolder-on-windows-7)の不具合です。回避策として，必要であれば，目的のフォルダーまでスクロールするようコマンドが改修されました。

* ACI0093858 リストフォームに複数のブレークが設定されている場合，「ブレーク1，ブレーク2，ブレーク3，ブレーク」のような順序でプロパティリストに表示されました。ヘッダーの順序は問題ありません。

* ACI0095181 [IMPORT TEXT](http://doc.4d.com/4Dv15R4/4D/15-R4/IMPORT-TEXT.301-2824550.ja.html)の速度が15.1と比較してずっと遅くなりました。

* ACI0089189 クエリエディターの入力エリアで``backspace``キーをタイプしたときの動きが変でした。

* ACI0091247 Mac版のみ。階層リストに``Carriage return``が含まれるテキストを表示した場合，2行にわたってテキストが表示されました。

``注記:** 修正により，改行コード以降のテキストは切り捨てられるようになりました。

* ACI0091711 クエリ定義ファイルをロードすると空のエラーダイアログが表示されることがありました。


* ACI0092067 ストラクチャエディターの「インデックス」画面からオブジェクト型フィールドのインデックスを削除することができませんでした。画面上はインデックスが削除されたようにみえますが，データベースを再起動すると，実際には削除されていないことがわかります。コンテキストメニューなど，他の方法であれば問題なく削除することができます。

* ACI0092650 メソッドエディターに改行コード（バックスラッシュ記号）が使用されている場合，日本語変換中のガイドラインが2行目以降は左にずれて表示されました。

* ACI0092893 スタンドアロン版で「最近使用したデータベース」メニューからアプリケーションを再起動した場合，デザインモード「ツール」メニューに「4D View」（あるいは何であれ最初に表示されるべきプラグインツール）が表示されませんでした。

* ACI0092903 [WP EXPORT VARIABLE](http://livedoc.4d.com/4D-Write-Pro-15-R4/4D-Write-Pro/WP-EXPORT-VARIABLE.301-2821091.ja.html)で4D Write ProをMIME形式でエクスポートした場合，76文字を超過する行に改行コードが挿入されないため，そのメッセージをメール送信しても相手側で正しく表示されないことがありました。

**注記**: 修正により，990文字を超過する行に改行コードが挿入されるようになりました。本来，BASE64パートの1行が76文字を超えないようにする必要はありません。78文字（改行コードを含む）が推奨されているのは，ユーザーインタフェースに表示できる行数が限られていた，昔のメールクライアントを考慮したものであり，今日のメールクライアントでは，問題になりません。今回の問題は，メールクライアントではなく，SMTPサーバーの行数サイズに対応するためであり，そのサイズは，78文字ではなく，1000文字となっています。998文字ではなく，990文字で改行コードが挿入されるようになったのは，一部の特殊なSMTPの仕様に合わせるためです。

* ACI0093521 自動アップグレードで旧ネットワークレイヤーから新ネットワークレイヤーにサーバーを入れ替えた場合，SSLが有効にされていると，クライアントの再接続に失敗しました。

* ACI0093541 ストラクチャエディターでテーブルの下の方にあるフィールドを選択した状態から別のフィールド名を編集するためにクリックすると，テーブルがスクロールして不便でした。

* ACI0093776 [書き出しダイアログ](http://doc.4d.com/4Dv15/4D/15.1/Exporting-data-to-files.300-2679411.ja.html)の「区切り文字」設定エリアに数字とスラッシュ記号を入力すると，アプリケーションがクラッシュしました。たとえば，``13/10``と入力することができません。

* ACI0093949 階層ポップアップメニューに項目を追加すると，別の階層ポップアップメニューの選択された項目が変化することがありました。

* ACI0094031 クライアント側では，[SET DATABASE PARAMETER](http://doc.4d.com/4Dv15/4D/15.1/SET-DATABASE-PARAMETER.301-2686308.ja.html)の``Log command list``でログに記録されるコマンドを限定することができませんでした。

* ACI0094069 画像を含む4D Write Pro文書をメール送信した場合，Outlookに画像が表示されませんでした。

**注記**: 一部のメールサーバーは，メールの本文を解析し，990文字毎に改行コードを挿入します。しかし，[WP EXPORT VARIABLE](http://doc.4d.com/4Dv15R4/4D/15-R4/WP-EXPORT-VARIABLE.301-2821091.ja.html)は最長997文字の行を出力することがありました。

* ACI0094194 Windows版のみ。ドロップダウンリストを矢印キーでスクロールし，``enter``キーで[CONFIRM](http://doc.4d.com/4Dv15R4/4D/15-R4/CONFIRM.301-2825910.ja.html)ダイアログを選択および確定すると，アプリケーションがクラッシュしました。

* ACI0094250 Mac 64bits版（日本語）のみ。新規データベースを作成した直後にエラーメッセージが表示されました。

**注記**: 64ビット版の日本語形態素分解ライブラリ``mecab``が正しくビルドされていなかったことが原因でした。

* ACI0094273 ツールボックスのフィルターで新規フィルターを追加し，テストエリアに何かを入力した場合，入力した値ではなく，デフォルト値である「123,45」がテストエリアに表示されました。

* ACI0094545 [OBJECT SET FONT SIZE](http://doc.4d.com/4Dv15/4D/15.1/OBJECT-SET-FONT-SIZE.301-2685680.ja.html)や[OBJECT SET FONT](http://doc.4d.com/4Dv15/4D/15.1/OBJECT-SET-FONT.301-2685674.ja.html)をリストボックス全体に対してコールした場合，リストボックスヘッダーのフォントサイズを変更することができませんでした。ヘッダーに対してコールした場合は問題ありません。

* ACI0094570 [FORM SCREENSHOT](http://doc.4d.com/4Dv15/4D/15.1/FORM-SCREENSHOT.301-2685887.ja.html)は，高解像度（Retina）ディスプレイ対応の画像を返しませんでした。

* ACI0094574 スタートアップで（画像が収まるように）スプラッシュスクリーンをリサイズした場合，ウインドウをマウスでリサイズしても，ウインドウに合わせて画像がリサイズされませんでした。再起動後など，スプラッシュスクリーンをリサイズする必要がなければ，問題なく画像が表示されます。

* ACI0094592 Mac OS X 10.11 ドイツ語版のみ。検索ダイアログに表示されるキャンセルボタンの幅が不足していました。"Abbrechen"と表示するためには，100px程度の幅が必要です。

* ACI0094604 左右のマウスボタンを続けてクリックした場合，4Dを再起動するまでてコンボボックスのメニューが表示されたままになりました。

* ACI0094651 配列型リストボックスを印刷した場合，ピクチャーの透明な背景が黒く出力されました。

* ACI0094670 [MODIFY SELECTION](http://doc.4d.com/4Dv15/4D/15.1/MODIFY-SELECTION.301-2684948.ja.html)を実行している値，ヘルプメニューの項目を選択することができませんでした。

* ACI0094753 [WEB SET OPTION](http://doc.4d.com/4Dv15/4D/15.1/WEB-SET-OPTION.301-2685155.ja.html)で``Web inactive process timeout``を指定しても，セッション管理されたWebプロセスのタイムアウトが変更されず，データベース設定のタイムアウトが適用されました。

* ACI0094816 いくら削除してもWebサーバーを起動するたびに``index.html``ファイルが作成されました。

* ACI0094834 Mac版のみ。4D Write Proで``Myriad Pro``や``Trade Gothic LT Std``といったフォントを使用した場合，各行で上端の数ピクセルが欠けました。通常の変数やフィールドでは，最初の行だけが欠けます。

**注記**: システムの不具合が関係しています。最初の行で上端の数ピクセルが欠ける問題は，標準アプリのテキストエディットでも再現します。今回の修正は，最初の行以外でもピクセルが欠けていたことを解消するものです。4D Write Proの場合，罫線があり，パディングのない段落では，同じ問題が発生します。システムから返される行の高さが間違っているためです。問題を回避するためには，段落の上パディングを増やすことができます。しかし，通常の変数やフィールドでは段落のパディングを変更することができません。

* ACI0094837 [OBJECT SET FONT](http://doc.4d.com/4Dv15/4D/15.1/OBJECT-SET-FONT.301-2685674.ja.html)でリストボックスのフォントを``%password``に設定することができませんでした。

* ACI0094868 Windows版のみ。フォームエディター上で複数のリストボックスヘッダーを選択することができませんでした。

* ACI0094947 階層リストボックスをセットアップ（作成およびデータ挿入）したのと同じメソッド内でコールされた場合，[LISTBOX SELECT BREAK](http://doc.4d.com/4Dv15/4D/15.1/LISTBOX-SELECT-BREAK.301-2686094.ja.html)は何もしませんでした。階層リストボックスでなければ問題ありません。

* ACI0094982 [DOM Count XML element](http://doc.4d.com/4Dv15/4D/15.1/DOM-Count-XML-elements.301-2685116.ja.html)は大文字と小文字を区別しませんでした。

* ACI0094988 階層リストボックスをセットアップ（作成およびデータ挿入）したのと同じメソッド内でコールされた場合，[LISTBOX SELECT ROW ](http://doc.4d.com/4Dv15/4D/15.1/LISTBOX-SELECT-ROW.301-2686109.ja.html)は何もしませんでした。階層リストボックスでなければ問題ありません。

* ACI0094996 スタイル付きリストボックスに表示された日本語テキストは，そうではないセルと比べ，1ピクセル高い位置に表示されました。

**注記**: Mac版だけが修正されました。Windowsでは，標準テキストの表示にはGDI，スタイル付きテキストの表示にはRicheTextEditが使用されています。しかし，日本語フォントは，行の高さがGDIとRicheTextEditで違うことがあります。たとえば，「メイリオ」の場合，行の高さがGDIでは16，RicheTextEditでは24かもしれません。Windowsでリストボックスをデザインする場合，標準テキストとスタイル付きテキストのどちらでも十分の高さになるようにデザインしてください。RicheTextEditが十分収まるような高さに行が設定されていれば，今回の問題は発生しません。あるいは，スタイルを使用する予定がない列もスタイル付きプロパティを有効にすることにより，テキストの位置を揃えることができます。

* ACI0095000 プライマリーキーまたは重複不可フィールドを含む複合インデックスを削除することができませんでした。

* ACI0095020 クエリエディターで日付型の「よりも前である」などを選択すると，入力フィルターに阻まれて日付入力できませんでした。

* ACI0095030 左右のマウスボタンを連続クリックすると，ダブルクリックイベントが発生しました。

* ACI0095036 コンパイルパスが「すべて定義する」に設定されていない場合，コンパイル/シンタックスチェック時に日本語の変数名が化けて表示されました。

* ACI0095055 最前面アプリケーションを切り替えると，変換中の日本語入力が確定されてしまいました。

**注記**: Mac版では，入力中の日本語を引き続き編集することができます。Windows版では，これまでどおり，変換中の日本語入力が確定されます。

* ACI0095077 Mac版のみ。アプリケーションのパスにアクセント記号が含まれる場合，``SET DATABASE PARAMETER(Spellchecker;1)``でクラッシュしました。

* ACI0095091 サブフォームから表示された入力フォームでは，階層ポップアップメニューをクリックしても，2度目以降はポップアップメニューが表示されませんでした。

* ACI0095118 リストボックスに同じ配列が2個以上表示されている場合，ヘッダークリックによる並び替えが正しく働きませんでした。

* ACI0095155 フォームエディター上でオブジェクトをクリックした場合，クリック中に少しでもマウスを動かすとオブジェクトが移動してしまいました。

* ACI0095184 「プリント時可変」プロパティが有効にされたフィールドをプリントアウトした場合，間違った位置にオブジェクトが印刷されることがありました。

* ACI0095231 
[自動アップデート](http://doc.4d.com/4Dv15/4D/15.1/Automatic-updating-of-server-or-single-user-applications.300-2679426.ja.html)のログに問題がありました。旧フォルダーが削除（ごみ箱に移動）できなかった場合，アップデートが完了していても，ログには"Update failed"というエラーが報告されました。フォルダーはマニュアル操作で削除することができ，アップデート自体は完了しているので，これを不明なエラーとして報告する必要はないはずです。

修正前のログ

```
2016-05-13 10:22:05 [4DUP] ERROR - Wrong Parameter.  
2016-05-13 10:22:05 [4DUP] INFO - Update failed - 13.05.2016 - 10:22
2016-05-13 10:22:05 [xbox] ERROR - [661] Wrong Parameter.  , task #7920
```

修正後のログ
```
2016-06-15 14:19:49 [4DUP] ERROR - Can't move ... into trash.
2016-06-15 14:19:49 [4DUP] ERROR - The source or destination path exceeded or would exceed MAX_PATH.
2016-06-15 14:19:49 [4DUP] INFO - Update failed - 6/15/2016 - 2:19
2016-06-15 14:19:51 [PW32] ERROR - [121] The source or destination path exceeded or would exceed MAX_PATH., task #2412
2016-06-15 14:19:51 [xbox] ERROR - [661] Can't move ... into trash., task #2412

* ACI0095257 15.2以降，テキストの最後に空白文字がない限り，テキストの最後をクリックしてカーソルをそこに移動することができませんでした。

* ACI0094114 [WR PRINT](http://doc.4d.com/4Dv15/4D-Write/15/WR-PRINT.301-2398714.ja.html)で既存のPDFファイルを上書きすることができませんでした。

* ACI0095051 4D Writeの自動スペルチェックは処理が遅すぎました。

* ACI0095060 4D Writeの「保存」メニューを選択した場合，すでに文書がディスクに保存されていたとしても，再び保存ダイアログが表示されました。

* ACI0095303 特定の条件が満たされた場合，[WR ON ERROR](http://doc.4d.com/4Dv15/4D-Write/15/WR-ON-ERROR.301-2398671.ja.html)が原因でアプリケーションがクラッシュする可能性がありました。
