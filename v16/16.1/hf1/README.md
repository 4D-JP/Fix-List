## 4D v16.1 Hotfix 1

![jp](https://cloud.githubusercontent.com/assets/10509075/16182979/016305e0-36e7-11e6-816b-2335cc6f0abb.png)

* ACI0095296 Mac 64ビット版のみ。"ヒラギノ角ゴシック ``W0``から``W9``などのフォントは，ツールボックスのスタイルシートページに表示されませんでした。

* ACI0096815 Webプロセスの``DIGETST``認証（4Dパスワードを含む）を有効にした場合，ブラウザがパスワード入力ダイアログを表示するまでに何十秒も待たされました。

* ACI0096617 Mac 64ビット版のみ。詳細フォーム使用中にエラーダイアログが表示された場合，以後，日本語入力ができなくなりました。

* ACI0096588 ``HTTP Get``をループの中で繰り返し実行していると，アプリケーションがクラッシュする場合がありました。

**注記**: ``ACI0095160``の修正が関係しています。サーバーからデータが``chunked``で返された場合の対応が正しくありませんでした。

* ACI0095580 Windows版のみ。自動スタイルシート（Window 10であればYu Gothic UI）でフォントが設定されたリストボックスは，セル入力中に日本語変換用のガイドラインが表示されませんでした。ガイドラインの表示位置が低すぎるためです。

**修正前**

![bad](https://cloud.githubusercontent.com/assets/10509075/25938250/94b3d752-3669-11e7-9620-6fb3232df01d.png)

**修正後**

![good](https://cloud.githubusercontent.com/assets/10509075/25938251/94b754b8-3669-11e7-8b4c-1e2b4e22d109.png)

* ACI0096548 Mac版のみ。ファイルサイズが0のドキュメントを``Document to text``で読み込もうとすると，``utf-8``エンコーディングを指定しない限り，error in user parameter list (paramErr) というエラーが返されました。

* ACI0096403 Mac 64ビット版のみ。リストフォームに表示されたスタティックテキスト以外のオブジェクト（ボタン・ポップアップ・テキスト入力エリアなど）は，オブジェクトの表示（常に・レコード選択時・レコード非選択時）プロパティを無視しました。

* ACI0096608 入力不可・フォーカス不可のテキスト入力オブジェクト上でフォントピッカーまたはカラーピッカーを表示すると，アプリケーションがクラッシュしました。

* ACI0096620 Mac 64ビット版のみ。文字列フィールドに日本語を入力しようとした場合，変換中の文字列に対してフィールドの文字数制限が適用されました。文字列長は実際に確定した文字列に対して適用されるべきです。

---

* ACI0096643 フォームエディターのメニューでオブジェクトを背面に移動した場合，すぐには変更が反映されませんでした。つまり，前面に戻すことができませんでした。オブジェクトを再選択すれば，問題ありません。

* ACI0096552 水平スクロールバーが表示された階層リストの反応が良くありませんでした。WindowsはMacよりも問題が顕著です。

* ACI0096551 Mac版のみ。アプリケーションのメインウィンドウ（スプラッシュ画面）に4Dのアイコンが表示されませんでした。「データベース設定 > 一般」で起動時モードが「アプリケーション」に設定されている場合に問題が発生します。メニューを実行してモードを切り替えた場合には問題ありません。

**注記**: 下記のファイルがビルドに含まれていなかったことが原因でした。

```
Content/Resources/Image/WindowIcons/windowIcon_205.icns
```

* ACI0096428 バージョン6.7で作成されたユーザー/グループファイル（``.4UG``）を読み込めないことがありました。サイズが17KBのときは問題ありませんが，35または39KBの場合，Windowsではクラッシュ，Macではアプリケーションが不安定になりました。データベースのアップグレードでも同じ問題が起こり得ました。

* ACI0096272 アイテムが区切り線（``-``）だけのポップアップ/ドロップダウンメニューをクリックするとアプリケーションがクラッシュしました。

* ACI0096702 階層リストボックスの制御にメモリーリークがありました。解放されないメモリのサイズは，表示されている行数および階層の数に左右されます。たとえば，25,000要素×3列のリストボックスを表示し，下矢印キーを押したまま
アクティビティモニター（Mac）またはタスクマネージャー（Windows）で監視していると，使用メモリが増えてゆき，32ビット版の場合，3.8GBに達したところでアプリケーションがクラッシュします。

* ACI0096684 サーバーに接続した4D Remoteの『4Dについて...』ダイアログは『リモートモード』と表示されるべき箇所に『Server』と表示されました。

* ACI0096631 リストボックスに表示された数値型配列に選択リストを関連付けたときの動作が正しくありませんでした。テキスト型配列では問題ありません。

* ACI0095968 クエリエディターには``SET TABLE TITLES``でカスタマイズされた順序でテーブル名が列挙されませんでした。

**注記**: 原則として4Dは``SET TABLE TITLES``でカスタマイズされた順序（バーチャルストラクチャ）を反映するようになっていますが，クエリエディターにはマスターテーブルのリレートテーブルを列挙する仕組みがあり，その過程で並び順が失われていました。修正により，マスターテーブルが先頭に表示され，続いてリレートテーブルが名前順に表示されるようになりました。

* ACI0096314 何もエラーが発生していない状況で``XML GET ERROR``を実行すると，アプリケーションが終了しました。

```
C_TEXT($Ref;$Error)
$Ref:=DOM Create XML Ref("my_root")
TRACE
XML GET ERROR($Ref;$Error)
DOM CLOSE XML($Ref)
```

* ACI0096589 ``LISTBOX SET HIERARCHY``でページ2以降に配置された階層リストボックスの階層を操作した後，`` FORM GOTO PAGE``でそのページに移動しようとすると，アプリケーションが終了しました。

* ACI0094940 クイックレポートエディターを起動した後，プリントプレビューを実行すると，エディター上のラベル「レコード/セレクション」および「レコード/テーブル」が消え，それぞれ数だけが画面上に表示されました。

* ACI0096560 階層リストボックスのたたまれた行に対して``EDIT ITEM``を実行した場合，その階層が表示されるようになりますが，その後，出現した分の行数だけ移動できる距離が下方向に延長されておらず，最後までスクロールすることができませんでした。

* ACI0096595 デザインモード・ツールバーの「新規」ボタンは，メソッドエディターやフォームエディターを使用しているときでも，常に新規データベースの作成ダイアログを表示しました。エディターが開かれているときは，状況に応じ，新規テーブル・メソッド・フォームの作成ダイアログが表示されるべきです。

* ACI0096600 Windows 32ビット版のみ。リストフォームを印刷（``XPS``プレビューを含む）すると，背景色の設定されたスタイル付きテキストの位置がずれました。

* ACI0096464 Windows版のみ。``OB GET``コマンドは，16進数表記の整数を変換しませんでした。たとえば，``0x00FFFFFF``を取り出そうとした場合，``16777215``ではなく，``0``が返されました。

```
C_OBJECT($obj)
C_LONGINT($decimal)
C_TEXT($hex)

OB SET($obj;"hex";"0x00FFFFFF")
$decimal:=OB Get($obj;"hex";Is longint) 
```

* ACI0096386 4D Server上でWebサーバーを起動した後に管理者（``Administrator``）のパスワードを変更した場合，``On Web Authentication``データベースメソッドが実行されると，以前のパスワードに戻ってしまいました。デスクトップ版では問題ありません。また，``Designer``や一般ユーザーアカウントも問題ありません。

* ACI0096637 Mac 64ビット版のみ。ダイアログで表示したウィンドウとデバッガの間を行き来しているとアプリケーションがクラッシュしました。

* ACI0096455 Windows 64ビット版のみ。ポーランド語・セルビア語・チェコ語などで使用する文字を``Alt``+``0`` ``1`` ``8`` ``5``, ``Alt``+``0`` ``2`` ``3`` ``4``といったテンキーシーケンスで入力することができませんでした。

* ACI0095985 Windows版のみ。マウスボタンを押し続けている間，``eAE_Idle``イベントがプラグインに渡されませんでした。

* ACI0096581 Windows版のみ。ビルドしたサーバーアプリケーションをサービス登録した場合，コマンドライン引数の``-d``でデータファイルの場所を指定することができませんでした。

***注記**: アプリケーション配布の新しいアーキテクチャーが有効にされている場合に影響があります。以前のアーキテクチャーでは，データファイルのパスがストラクチャに書き込まれていたので，引数で指定することはありませんでした。

* ACI0096436 アプリケーション配布の新しいアーキテクチャーを有効にし，ビルドしたサーバーアプリケーションをサービス登録した場合，``lastDataPath.xml``に記述されたパス（最後にダイアログ経由で選択したデータファイルのパス）が使用されませんでした。デフォルトのデータファイルがみつからない場合，毎回，データファイルを指定するためのダイアログが表示されました（デスクトップとの対話が許可されている場合）。

* ACI0096528 ``EXPORT DATA``で書き出しダイアログを表示した場合，カレントセレクションの並び順が反映されませんでした。

**注記**: 内部的にセットが使用されていたことが原因です。修正により，内部的に命名セレクションが使用されるようになりました。

* ACI0096491 4D Write Pro文書が保存されたオブジェクト型フィールドを標準のダイアログで書き出した後，読み込んだ場合，ドキュメントの内容が空でした。

**注記**: オブジェクト型フィールドの特殊データ（Write Pro文書など）がバイナリ形式で表現されるようになりました。``SEND VARIABLE/VARIABLE TO BLOB``などの変換コマンド，``Execute on server``/``EXECUTE ON CLIENT``などの転送コマンド全般に影響があります。``SEND RECORD``は影響ありません。

* ACI0096596 Windows版のみ。メソッドエディターにある程度（50行以上）のテキストを入力すると，文字入力の反応が明らかに遅くなってゆきました。

* ACI0096391 Windows版のみ。``Print object``コマンドでリストボックスを印刷すると，ヘッダーのテキストが出力されませんでした。

* ACI0096514 Mac版のみ。アプリケーションビルドのダイアログで4D Volume Desktop以外の4Dアプリケーションを選択することができました。以前のバージョンでは，エラーが表示されました。

* ACI0096261 Windows版のみ。4D ODBC Driverの著作権表示が2017ではなく，2016年のままでした。

* ACI0095258 ツールボックスでリストを複製した場合，項目の参照番号がリセットされました。

* ACI0096743 ``MSG_GetBody``はメール本文に含まれるアクセント文字を正しく返しませんでした。

* ACI0096740 ``WEB SEND HTTP REDIRECT``をコンポーネント内で使用することができませんでした。

* ACI0096693 32ビット版のみ。``PRINTERS LIST``から返されるテキスト配列は，各要素の末尾にヌル文字が追加されていました。プリンターの指定には支障ありませんが，プリンター名を文字列として扱いたい場合に問題が生じる可能性があります。

* ACI0096670 ``SMTP_Body``でHTMLメールを送信した場合，本文の末尾にヌル文字が追加されました。スパムフィルターやウイルススキャン等によってメールがキャッチされ，相手に届かない恐れがありました。

* ACI0096665 ``SMTP_SetPrefs``で1行の長さを設定することができますが，``Base64``エンコーディングでメッセージをエンコードした場合，1行置きに変な長さで改行が実施されました。たとえば，1行の長さを``76``とした場合，``76``, ``26``, ``76``, ``26``といった具合に改行コードが挿入されました。

* ACI0096649 『...と...の間』条件のクエリ設定ファイルを読み込んだ場合，開始値が終了値と同一になりました。たとえば，「2017/1/1から2017/2/2の間」という条件は「2017/2/2から2017/2/2の間」になりました。

* ACI0096647 Internet Commandsで送信したメールの添付画像ファイルは，Appleのメールクライアントで受信した場合，画像が2回表示されました。``Content-Disposition``が``inline``ではなく``attachment``とされているためです。

* ACI0096598 Windows版のみ。ビルドアプリケーションのカスタムアイコンファイルは，``48x48``の低い解像度で収録されました。```256x256``など，ビルドプロジェクトファイルで指定した``.ico``ファイルの解像度がそのまま使用されるべきです。

**注記**: 修正が反映されるためには，アイコンキャッシュをクリアする必要があるかもしれません。

```
ie4uinit.exe -ClearIconCache
```

* ACI0096580 32ビット版のみ。``ALERT``, ``Request``, ``CONFIRM``など，特定の標準コマンドを実行すると，非アクティブだったメニューアイテムがアクティブになることがありました。

* ACI0096577 Mac版のみ。Actual TechnologiesのODBCドライバーを使用してMySQLに``VARCHAR``または``CHAR``型のデータを``INSERT``しようとすると，エラーコード``9922``が返されました。

* ACI0096567 4D Writeプラグインで作成した文書を``WP Import document``でWrite Proにインポートした場合，複数行のテキストが含まれるテーブルがうまく変換されませんでした。

* ACI0096710 Mac版のみ。キーボードショートカット経由でボタンをクリックすると，アプリケーションがクラッシュする場合がありました。特定のストラクチャだけで発生する問題です。マウスクリックであれば問題ありません。AreaList Proプラグインが表示されたフォームを確定（``ACCEPT``）したタイミングで発生しやすいようです。

* ACI0096675 Mac版のみ。ODBCドライバー経由でテーブル名が正しく返されませんでした。``Table_1``の代わりに``Tbe1``が返されました。``UTF-16``エンコーディングが正しく処理されていないようです。

**注記**: 修正されたのはODBC Driverです。ドライバーをアップデートしてください。

* ACI0096136 リストボックスの水平リサイズプロパティを「拡大」に設定した場合，テキスト入力中にリストボックスをリサイズすると，編集した内容が元に戻ってしまいました。

* ACI0095160 ``HTTP Request``または``HTTP Get``でJSONテキストを受信した場合，途中でデータが切れていることがありました。HTTPヘーダー``Transfer-Encoding``が``chuncked``のときに発生します。

* ACI0096741 4D Write文書（``.4W7``）を4D Write Pro文書（``.4wp``）に変換した場合，若干，タブの幅が違うために，文書のレイアウトが崩れることがありました。

* ACI0096802 ビルドしたクライアント/サーバーアプリケーションでデータベース設定の「クライアント/サーバー」ページを開くと，エラーが返されました。

* ACI0096728 クライアント側でスリープ・スリープ解除・プロセスの終了・スリープを何度も繰り返していると，接続が切断されたり，アプリケーションがフリーズする場合がありました。

* ACI0096490 旧ネットワークレイヤーのみ。``EXECUTE ON CLIENT``および``Execute on server``を繰り返し実行していると，サーバーがフリーズしました。新ネットワークレイヤーでは問題ありません。コンパイルモードで問題が発生します。コマンドの代わりに「サーバー上で実行」メソッドプロパティを使用すれば問題ありません。

* ACI0096161 64ビット版のみ。メソッドエディター使用中にヘルプTipsが表示された後，タイプ入力を続けていると，いつまでもヘルプTipsが消えませんでした。期待される動作は，タイプ入力の開始と同時にヘルプTipsが消えることです。

* ACI0096734 Mac版のみ。日付およびオブジェクト型のデータが``WA Evaluate Javascript``に認識されないことがありました。システムWebエリア特有の問題です。

* ACI0096690 `` SCREEN DEPTH``の定数名に廃止予定の識別子である``_o_``が付けられていませんでした。

* ACI0096787 ポップアップウィンドウに続けてアラートダイアログを表示した場合，ウィンドウ以外の場所をクリックしても，ポップアップウィンドウが閉じられませんでした。

* ACI0096625 Windows版のみ。キリル文字など，標準的な英数字以外がパスに含まれる場合，``The ICU framework is malformed. Please verify 4D installation.``というエラーが表示され，4Dが正常に起動できませんでした。

**注記**: ICUライブラリの[不具合](http://bugs.icu-project.org/trac/ticket/6539)が関係しています。修正により，キリル文字を使用するシステム言語でも起動できるように，``ICU``, ``Hunspell``, ``Altura``, ``WebKit``などのライブラリをロードする方法が見直されました。

* ACI0096501 Windows 32ビット版のみ。統合Webエリアにフォーカスが表示されている場合，他の4Dフォームオブジェクトをクリックしても，フォーカスが移動しませんでした。

* ACI0095160 ``HTTP Request``または``HTTP Get``でJSONテキストを受信した場合，途中でデータが切れていることがありました。HTTPヘーダー``Transfer-Encoding``が``chuncked``のときに発生します。
