4D v15.2 Hotfix 1
---

![jp](https://cloud.githubusercontent.com/assets/10509075/16182979/016305e0-36e7-11e6-816b-2335cc6f0abb.png)

* ACI0094996 スタイル付きリストボックスに表示された日本語テキストは，そうではないセルと比べ，1ピクセル高い位置に表示されました。

**注記**: Mac版だけが修正されました。Windowsでは，標準テキストの表示にはGDI，スタイル付きテキストの表示にはRicheTextEditが使用されています。しかし，日本語フォントは，行の高さがGDIとRicheTextEditで違うことがあります。たとえば，「メイリオ」の場合，行の高さがGDIでは16，RicheTextEditでは24かもしれません。Windowsでリストボックスをデザインする場合，標準テキストとスタイル付きテキストのどちらでも十分の高さになるようにデザインしてください。RicheTextEditが十分収まるような高さに行が設定されていれば，今回の問題は発生しません。あるいは，スタイルを使用する予定がない列もスタイル付きプロパティを有効にすることにより，テキストの位置を揃えることができます。

---

* ACI0093776 [書き出しダイアログ](http://doc.4d.com/4Dv15/4D/15.1/Exporting-data-to-files.300-2679411.ja.html)の「区切り文字」設定エリアに数字とスラッシュ記号を入力すると，アプリケーションがクラッシュしました。たとえば，``13/10``と入力することができません。

* ACI0095108 ストラクチャエディター上でフィールド名を編集し，``Tab``キーを押すと，右のテーブルにフォーカスが移動しました。おおきなストラクチャの場合，自分がどこにいたのかが分からなくなり，とても不便です。フィールド名を編集中にテーブルが切り替わるべきではありません。

* ACI0092903 [WP EXPORT VARIABLE](http://livedoc.4d.com/4D-Write-Pro-15-R4/4D-Write-Pro/WP-EXPORT-VARIABLE.301-2821091.ja.html)で4D Write ProをMIME形式でエクスポートした場合，76文字を超過する行に改行コードが挿入されないため，そのメッセージをメール送信しても相手側で正しく表示されないことがありました。

**注記**: 修正により，990文字を超過する行に改行コードが挿入されるようになりました。本来，BASE64パートの1行が76文字を超えないようにする必要はありません。78文字（改行コードを含む）が推奨されているのは，ユーザーインタフェースに表示できる行数が限られていた，昔のメールクライアントを考慮したものであり，今日のメールクライアントでは，問題になりません。今回の問題は，メールクライアントではなく，SMTPサーバーの行数サイズに対応するためであり，そのサイズは，78文字ではなく，1000文字となっています。998文字ではなく，990文字で改行コードが挿入されるようになったのは，一部の特殊なSMTPの仕様に合わせるためです。

* ACI0094651 配列型リストボックスを印刷した場合，ピクチャーの透明な背景が黒く出力されました。

* ACI0094753 [WEB SET OPTION](http://doc.4d.com/4Dv15/4D/15.1/WEB-SET-OPTION.301-2685155.ja.html)で``Web inactive process timeout``を指定しても，セッション管理されたWebプロセスのタイムアウトが変更されず，データベース設定のタイムアウトが適用されました。

* ACI0094868 Windows版のみ。フォームエディター上で複数のリストボックスヘッダーを選択することができませんでした。

* ACI0092700 階層リスト内で素早くドラッグ/ドロップ操作をすると，アプリケーションがクラッシュしました。

* ACI0093949 階層ポップアップメニューに項目を追加すると，別の階層ポップアップメニューの選択された項目が変化することがありました。

* ACI0094031 クライアント側では，[SET DATABASE PARAMETER](http://doc.4d.com/4Dv15/4D/15.1/SET-DATABASE-PARAMETER.301-2686308.ja.html)の``Log command list``でログに記録されるコマンドを限定することができませんでした。

* ACI0094604 左右のマウスボタンを続けてクリックした場合，4Dを再起動するまでてコンボボックスのメニューが表示されたままになりました。

* ACI0095109 特定の状況では，サーバー側で[TRACE](http://doc.4d.com/4Dv15/4D/15.1/TRACE.301-2684990.ja.html)を実行するとアプリケーションがクラッシュしました。

* ACI0093268 Mac版のみ。4D Viewのスクロール速度に問題がありました。Macのトラックパッドやマウスでエリアを上下にスクロールした場合，エリアが2本指スワイプ操作にほとんどついてこられませんでした。スクロール速度が非常にゆっくりで，移動の開始も遅れがちでした。今回の修正で4D Write, 4D View, プロパティリスト，クイックレポートの動作が改良されました。

* ACI0094561 サイズの小さなBLOBに対して[EXPAND BLOB](http://doc.4d.com/4Dv15/4D/15.1/EXPAND-BLOB.301-2686170.ja.html)のgzip圧縮を使用すると，エラーメッセージが表示されました。

```
C_BLOB($blbContent)
C_LONGINT($lngIsCompressed)

CONVERT FROM TEXT("test";"UTF-8";$blbContent)
COMPRESS BLOB($blbContent;GZIP best compression mode)

BLOB PROPERTIES($blbContent;$lngIsCompressed)
If ($lngIsCompressed#0)
  EXPAND BLOB($blbContent)
End if
```

* ACI0094933 メソッドエディターに[REDRAW WINDOW](http://doc.4d.com/4Dv15/4D/15.1/REDRAW-WINDOW.301-2686137.ja.html)と入力した後，コマンド名の上にマウスポインターを置くとシンタックスが表示されますが，その内容に誤記がありました。

* 誤 ``REDRAW WINDOW( windows )} ``

* 正 ``REDRAW WINDOW{( windows )} ``
  
* ACI0094740 [SELECTION RANGE TO ARRAY](http://doc.4d.com/4Dv15/4D/15.1/SELECTION-RANGE-TO-ARRAY.301-2685271.ja.html)で不正なセレクション範囲を指定した場合，アプリケーションがクラッシュしました。

```
//テーブルにレコードは1件のみ
ALL RECORDS([Table_1])
SELECTION RANGE TO ARRAY(3;2;[Table_1];$a)
```

* ACI0094964 [QUERY BY FORMULA](http://doc.4d.com/4Dv15/4D/15.1/QUERY-BY-FORMULA.301-2685583.ja.html)の動作がv13とv15では違いました。たとえば，下記のようなリレーションが3テーブル間に設定されている場合，v13で瞬時だったクエリがv15では0.2秒ほどになりました。

```
[PA_SEJOUR] 1<-N [PA_MVT] 1<-N [MVT_ACTES]
```

運用ではセレクションのサイズがあるので，ユーザーが苛立ちを感じるほどに時間がかかります。クエリパスを比較すると，明らかにv12とv15では違う処理がなされており，v15では途中でおおきな結果セットが作られていることがわかります。

* ACI0094401  クロスタブ型クイックレポート内の時間フィールドは，[Sum](http://doc.4d.com/4Dv15/4D/15.1/Sum.301-2686264.ja.html)の計算値が正しくありませんでした。小計値は秒単位，合計値は時間単位で値が表示されました。

* ACI0094120 ``$0``に値を返すようなメソッドが式ウォッチに登録されている状況で，[TRACE](http://doc.4d.com/4Dv15/4D/15.1/TRACE.301-2684990.ja.html)が使用されているメソッドを実行した場合，3回目のトレース以降はデバッガが使用できなくなりました。

* ACI0094029 [SET DATABASE PARAMETER](http://doc.4d.com/4Dv15/4D/15.1/SET-DATABASE-PARAMETER.301-2686308.ja.html)で``Circular log limitation``を指定すれば，ログファイルの数が最新のn個に制限されるはずですが，クライアント側では設定が無視され，延々とファイルが増えてゆきました。ターミナルクライアントはディスク容量が限られているため，このコマンドが特に必要です。

* ACI0091689 Windows版のみ。マーカーをcontrolクリックで削除することができませんでした。

![jp](https://cloud.githubusercontent.com/assets/10509075/16182979/016305e0-36e7-11e6-816b-2335cc6f0abb.png)

* ACI0092682 メソッド内に変数名がいくつも含まれる場合，日本語入力中に表示されるガイドラインの位置が左にずれて表示されました。

* ACI0094028 Mac版のみ。おおきな外部モニターをメイン画面として使用した場合，内部モニター（サブ画面）でクリックしたポップアップメニューの表示される位置が正しくありませんでした。 

* ACI0094194 Windows版のみ。ドロップダウンリストを矢印キーでスクロールし，Enterキーで選択および確定すると，アプリケーションがクラッシュしました。

* ACI0094314 Mac版のみ。[SET PRINT PREVIEW](http://doc.4d.com/4Dv15/4D/15.1/SET-PRINT-PREVIEW.301-2685618.ja.html)を実行すると，それまでに設定した用紙の向きがリセットされました。本来，コマンドの実行順序は関係ないはずです。

* ACI0094435 Mac版のみ。OS X 10.11 El Capitanでは，既定サイズよりも背の高いコンボボックスは正しく表示されませんでした。

* ACI0094454 リストフォームをダブルクリックしても，[FILTER EVENT](http://doc.4d.com/4Dv15/4D/15.1/FILTER-EVENT.301-2685822.ja.html)で画面の遷移を抑制することができます。ダブルクリックをフィルターして表示したダイアログから表示したダイアログを続けてキャンセルした場合，最初のリスト画面に復帰する代わりにフィルターしたはずの入力画面が表示されました。つまり，ダイアログを続けたことにより，フィルターが無効になりました。

* ACI0094739 Windows版のみ。終了処理中にメニューバークリックするとアプリケーションがクラッシュしました。

* ACI0094773 Mac版のみ。Retinaディスプレイに表示された4D Writeエリアに対して何かをドロップすると，画面の表示が乱れました。

* ACI0094861 [PRINTERS LIST](http://doc.4d.com/4Dv15/4D/15.1/PRINTERS-LIST.301-2685608.ja.html)が原因でクラッシュすることがありました。極めて特殊な状況でなければ再現しません。

* ACI0083980 データベース設定でメッセージフォントをクリックし，フォントピッカーをキャンセルしても，ピッカーで選択されていたフォントが採用されました。

* ACI0089399 コンポーネントメソッドを[4DACTION](http://doc.4d.com/4Dv15/4D/15.1/URLs-and-Form-Actions.300-2685147.ja.html)で呼び出すことができませんでした。

* ACI0093962 Mac版のみ。テキスト終わりにある空白をダブルクリックした場合，本来であれば最後のワードまたは空白が選択されるはずですが，何も起きませんでした。

* ACI0094045 [WR SAVE DOCUMENT](http://doc.4d.com/4Dv15/4D-Write/15/WR-SAVE-DOCUMENT.301-2398576.ja.html)でドキュメントをUTF-8形式で保存した場合，拡張子``txt``が省略されました。

```
$vl_Template:=WR New offscreen area 
$vt_Document:=System folder(Desktop)+"test.txt"
WR INSERT TEXT ($vl_Template;"4D is the best!!!")
WR SAVE DOCUMENT ($vl_Template;$vt_Document;wr unicode document UTF8)
WR DELETE OFFSCREEN AREA ($vl_Template)
```

* ACI0094410 バーコードフォントなど，一部のフォント名がラベルエディターのフォントリストに表示されませんでした。

注記: 表示されないフォント名は，現行のAPIではサポートされていないものです。（旧式のAPIを使用している）ラベルエディターのリストは修正されましたが，プロパティリストおよび[FONT LIST](http://doc.4d.com/4Dv15R3/4D/15-R3/FONT-LIST.301-2695248.ja.html)は，引き続き現行のフォント名だけが列挙されます。

* ACI0094451 SQL ``INTO``でBLOBフィールドをBLOB配列にコピーしようとしても，配列にデータが転写されませんでした。

* ACI0094502 Mac版のみ。iMacテンキーの``clear``を入力した場合，何もテキストが選択されていなければ，何も起きず，テキストが選択されていれば，制御文字が挿入されました。v13以前は，いずれの場合も制御文字が挿入されました。正しい動作は，選択されたテキストを削除するというものです。

* ACI0094571 テキストエリアの「ワードラップ」および「垂直スクロールバー」がともに「自動」に設定されていた場合，テキストがスクロールバーに重ねて表示されました。

* ACI0094606 ``Content-Type``ヘッダーが定義されていないリソースを[HTTP Get](http://doc.4d.com/4Dv15R3/4D/15-R3/HTTP-Get.301-2696227.ja.html)でダウンロードした場合，レスポンスが空でした。

注記: コマンドは``Content-Type``ヘッダーの``charset``の基づき，文字コードを特定しています。これがみつからない場合，デフォルトで``UTF-8``が選択されます。そのため，アクセスしたリソースの文字コードが実際には``UTF-8``でない場合，問題が発生しました。修正により，``charset``が不明な場合，HTMLあるいはXMLの宣言に基づいて文字コードの特定が試みられるようになりました。

* ACI0094646 一部の変換されたデータベースでは，新規作成したSQLスキーマが既存のデフォルトスキーマと入れ替わり，結果的にすべてのテーブルに適用されました。普通は再現しない問題です。修正により，データベース開始時にスキーマIDの重複が解決されるようになりました。

* ACI0094674 Windows版のみ。テキストエリアにハングルを入力すると，最後の文字が消えました。

* ACI0094690 隣接したテキストエリア上にスクロールバーを移動すると，テキストエリアのスクロールバーの表示が崩れました。

* ACI0094718 クライアント側で[SET QUERY DESTINATION](http://doc.4d.com/4Dv15/4D/15.1/SET-QUERY-DESTINATION.301-2685575.ja.html)を実行し，クエリデスティネーションをセットに設定した場合，UUIDフィールドにNULLが含まれていると，アプリケーションがクラッシュしました。

* ACI0094719 [GRAPH](http://doc.4d.com/4Dv15/4D/15.1/GRAPH.301-2685872.ja.html)でタイプ``2``グラフを描画した場合，値が0%の項目は棒が表示されないはずですが，実際には値が100%であるかのように描画されました。

* ACI0094725 フィールドにおおきなテキストが登録されている場合，フォームの表示にかなりの時間がかかりました。

* ACI0094799 Mac版のみ。サーバー側のWebサービスメソッド内で繰り返しPDFを作成していると，アプリケーションがクラッシュすることがありました。

![jp](https://cloud.githubusercontent.com/assets/10509075/16182979/016305e0-36e7-11e6-816b-2335cc6f0abb.png)

* ACI0094810 「サーバーに接続」画面に表示されるサーバーのコンピューター名に日本語が含まれる場合，内容が正しく表示されませんでした。たとえば，「Miyako の MacBook」の代わりに「Miyako ? MacBook」と表示されました。

* ACI0094851 何らかの理由で不正な``multipart/form-data``タイプのデータがWebサーバーに対して送信された場合，アプリケーションがクラッシュするまで無限ループに陥りました。

* ACI0094906 フォームが表示されていない状況でオブジェクト変数に対して[ST Get plain text](http://doc.4d.com/4Dv15/4D/15.1/ST-Get-plain-text.301-2686022.ja.html)を使用すると，アプリケーションがクラッシュしました。

* ACI0065508 リストボックスの``On Display Detail``イベントが``On Load``よりも先に実行されました。

* ACI0088167 [LISTBOX GET HIERARCHY](http://doc.4d.com/4Dv15/4D/15.1/LISTBOX-GET-HIERARCHY.301-2686097.ja.html)に列番号``0``を渡すと，アプリケーションがクラッシュしました。

* ACI0094555 いくつかのフィルターを続けて作成し，名前を変更した場合，間違ったフィルターの名前が更新されることがありました。

* ACI0094563 4D View Pro（拡張リストボックス）内に表示されたスリーステートチェックボックスをクリック操作で「中間」状態にすることができませんでした。

注記: 本来，スリーステートチェックボックスの中間（どちらでもない）状態は表示のためであり，これをクリックで指定できることは間違いであると考えられています。ただし，通常のチェックボックスが歴史的な経緯のより，これを許しています。修正により，4D View Pro（拡張リストボックス）のスリーステートチェックボックスであれば，同様のユーザーインタフェースが作成できるようになりました。

* ACI0094631 クエリエディターを表示し，自動リレーションが設定されたフィールドに対してクエリを実行すると，アプリケーションがクラッシュしました。

* ACI0094638 Mac版のみ。特定の状況では，保存またはキャンセルボタンが1回目のクリックに対して反応しませんでした。たとえば，リストボックスの値を選択リストで入力した直後に問題が発生しました。

* ACI0094692 Windows版のみ。コマンドで作成されたメニューの外観が以前のバージョンとは違いました。特にグレーアウトされた行やセパレーター行の表示が変でした。

* ACI0094710 Mac版のみ。リストボックスにフォーカスが置かれている状態でポップアップウインドウを表示した場合，そのポップアップウインドウにもテキスト入力が表示されていると，フォームを閉じた後に復帰したフォームのフォーカスが置かれたエリアにはカーソルが表示されず，テキストの選択された範囲はグレーアウトされていました。

* ACI0094775 リストボックスの行を移動する場合，端までドラッグ＆ドロップすると自動的に行がスクロールを始めますが，ロックされた列の上ではそのようになりませんでした。

* ACI0094778 Windows版のみ。アプリケーションビルドを何度も実行していると，フォルダー名を変更できないという趣旨のエラーメッセージが表示され，処理が中断されました。アップデートツールのマニフェストがインストールできない，というエラーが返されることもあります。

* ACI0094812 Mac版のみ。OS X 10.11 El Capitanで使用した場合，4D Writeおよび4D Viewプラグインが理由でアプリケーションがクラッシュしました。

* ACI0094826 [SVG_SET_OPTIONS](http://doc.4d.com/4Dv15/4D/15/SVG-SET-OPTIONS.301-2048793.ja.html)に``?+5``フラグを渡すと，XMLが改行コードで整形されますが，その場合，[SVG_GET_ATTRIBUTES](http://doc.4d.com/4Dv15/4D/15/SVG-GET-ATTRIBUTES.301-2048834.ja.html)から返される文字列に余計な空白文字が追加されました。

* ACI0094846 おおきなデータベース（例: 30GB），遅いサーバー（例: ハードディスク使用の仮想マシン）で自動アップグレードを実行した場合，処理が完了できないことがありました。ログファイルを調べると，最後のステップに7秒のタイムアウトが設定されていることが伺えます。

```
2016-03-16 03:46:16 [4DUP] INFO - Updater starting - 16.03.2016 - 03:46
2016-03-16 03:46:16 [4DUP] INFO - Waiting for external process to quit
2016-03-16 03:46:16 [4DUP] INFO - Application service stopped, proceeding
2016-03-16 03:46:16 [4DUP] INFO - Proceeding with up-to-date application install...
2016-03-16 03:46:54 [4DUP] INFO - Proceeding with up-to-date application restart...
2016-03-16 03:46:54 [4DUP] INFO - Restarting application service
2016-03-16 03:47:01 [4DUP] ERROR - Failed to restart updated application as service
2016-03-16 03:47:01 [4DUP] ERROR - Up-to-date application restart failed
```

* ACI0094900 Windows版のみ。TeamViewerで接続した環境で印刷画面やファイル選択画面などのシステムダイアログを表示すると，アプリケーションがクラッシュしました。
