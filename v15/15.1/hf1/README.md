4D v15.1 Hotfix 1
---

* ACI0093137 [4D Pop](http://sources.4d.com/trac/4d_4dpop)で定義したカスタム定数にアクセント記号が含まれている場合，コンパイルができませんでした。

* ACI0093216 Mac版のみ。Yosemiteプラットフォームでカラーピッカーの16進数画面に値を入力し，同じ値でカラーピッカーを表示すると，別の値が表示されました。

**注記**: Macのカラーピッカーは，デフォルトでsRGB色空間を使用しており，4DアプリケーションのデバイスRGB色空間とは，赤青緑コンポーネントの値が違います。修正により，カラーピッカーから4D，および4Dからカラーピッカーに渡されるRGB値の色空間を変換し，同じ『色』が表示されるようになりました。色空間と赤青緑コンポーネントの値の関係を検証するためには，カラーピッカーの色空間をデバイスRGBに変更することができます。そうすれば，4Dとカラーピッカーの間で同じ値が同じ色になることを確かめることができるはずです。色のRGB値を確認するのであれば，カラーピッカーがデフォルトで表示する値ではなく，常にデバイスRGB色空間で表現される4Dのコマンドの戻り値を比較してください。

参考記事: http://www.4d.com/jp/blog/color-picker-and-color-space.html

* ACI0093713 [IT_ErrorText](http://doc.4d.com/4Dv15R2/4D-Internet-Commands/15-R2/IT-ErrorText.301-2666715.ja.html)に-32768よりも小さいエラー番号を渡すと，アプリケーションがクラッシュしました。

* ACI0093751 デバッガーの式ペインにプロジェクトメソッド名を入力すると，アプリケーションがクラッシュしました。

* ACI0093783 イタリック体の文字列がすでに入力されている4D Write Proエリアで，（テキストを選択せずに，カーソルが点滅している状況で）コンテキストメニューからフォントスタイルを変更した場合，以後，タイプされた文字列は前の文字列からスタイル属性を引き継ぎました。これは，Wordやテキストエディターなどの動作とは違うものであり，ユーザーを混乱させるものでした。

* ACI0093793 [ACCEPT](http://doc.4d.com/4Dv15R2/4D/15-R2/ACCEPT.301-2542997.ja.html)を繰り返し実行すると，アプリケーションがクラッシュしました。

* ACI0093826 v2004以前に作成されたストラクチャでメソッド名にアクセント記号が使用されている場合，アップグレード後に『メソッドがみつかりません』エラーが発生しました。非Unicodeモードにおける文字列リテラルの変換が間違っていました。推奨されているように，Unicodeモードを有効にすれば，問題ありません。

* ACI0094189 アイテム数が0のコンボボックスをクリックし，下矢印キーを入力すると，アプリケーションがクラッシュしました。

* ACI0094267 非表示のテーブルやフィールドが存在するストラクチャでテーブルタイトルやフィールドタイトル（バーチャルストラクチャ）を設定した場合，4D Viewエリアでは非表示のフィールドにアクセスすることができました。

* ACI0086874 4D Viewを使用中に，ドイツ語キーボートでControl+Alt+2を入力した場合，³ではなく，3³がタイプされました。スイス地域キーボートでControl+Alt+2を入力した場合，@ではなく，2@がタイプされました。

* ACI0090056 データベースフォルダーに対する相対パスでデフォルトHTMLルートフォルダーが設定されている場合，ビルドされたアプリケーションで，フォルダーパスが正しく表示されませんでした。たとえば，

```
.\DataBaseName\Database\Database\WebFolder
```

のようなパスは，設定画面に

```
.\DataBaseName\Database\WebFolder
```

と表示されました。

* ACI0094156 Windows版のみ。クイックレポートで作成したデータにひとつ以上の空白文字が含まれている場合，プレビューやプリンターで空白の数だけ空行が出力されました。ACI0090654が修正されたことの副作用でした。

* ACI0093988 [CONVERT FROM TEXT](http://doc.4d.com/4Dv15R2/4D/15-R2/CONVERT-FROM-TEXT.301-2543340.ja.html)で無効な文字列をISO-2022-JPに変換しようとした場合，``error in user parameter list (paramErr)``というシステムエラーが返されました。バッファサイズ不足による問題でした。

```
CONVERT FROM TEXT ("髙橋髙橋髙橋";"iso-2022-jp";$data)
```

* ACI0093941 [MSG_Extract](http://doc.4d.com/4Dv15R2/4D-Internet-Commands/15-R2/MSG-Extract.301-2666848.ja.html)は，添付ファイルのファイル名に``/ \ : * ? " < > |``記号が含まれている場合，実際に作成されるファイル名（``MailDownload.msg``など）ではなく，間違った名前を返しました。

**注記**: 問題のある文字は，Windowsシステムで許可されないものです。Macで許可されないのは，``:``だけです。そのようなファイル名がメールから抽出された場合，Internet Commandsは代わりに一意のファイル名を発行します。問題は，プラグインが実際に使用されたファイル名ではなく，抽出された無効なファイル名を返していることにありました。

* ACI0093913 [IMPORT DATA](http://doc.4d.com/4Dv15R2/4D/15-R2/IMPORT-DATA.301-2543784.ja.html)にプロジェクトファイルを渡してダイアログを表示した場合，プロジェクトで設定されたエンコーディングではなく``UTF-8``が常に選択されました。ポップアップメニューでエンコーディングを改めて選択すれば問題ありません。ダイアログを表示しなかった場合，やはりUTF-8が常に使用されました。

* ACI0093832 『マルチスタイル』プロパティが有効にされているオブジェクトは，印刷または表示時にカラー・フォント・スタイルプロパティをコマンドで設定しても，変更が反映されませんでした。v13では問題ありません。
 
* ACI0093589 Windows版のみ。ODBC経由で4Dのフィールドを更新しようとすると，MS Queryがクラッシュしました。INSERTでは問題ありません。UPDATEコマンドに問題があります。

```
UPDATE Table_1
SET Table_1.Champ_2='aaaa'
WHERE Table_1.Champ_2='ZZZZZZ';
```

* ACI0093451 互換性オプションの『ブラケットの代わりにをコメント使用する』が有効にされて**いない**場合『4Dについて』画面が正しく表示されませんでした。

* ACI0093179 Windows版のみ。システムWebエリアは，Internet Explorer 11がインストールされていても，IE9互換モードで実行されました。ユーザーエージェントの値がそのことを示唆しています。

```
Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/7.0)
```

JavaScriptの```navigator.userAgent```を実行しても，似たような結果が返されました。

**注記**: システムWebエリアが使用しているWeb Browserコントロールは，Windows 10の標準ブラウザであるEdgeモードをサポートしていません。したがって，Windows 10で使用した場合，WebエリアはIE11互換モードで動作することになります。

* ACI0093098 リストボックスの列は，垂直揃えが『中央』あるいは『下』，行の高さが『1行』でフォントが『ヒラギノ角ゴ ProN W3』に設定されている場合，文字のデセント部分，たとえばqpyjçなどの『ぶらさがり』が完全に表示されませんでした。デセントではなく，ベースラインに対して文字列が揃えられているようでした。

* ACI0092900 v13.4以降，[PROCESS 4D TAGS](http://doc.4d.com/4Dv15R2/4D/15-R2/PROCESS-4D-TAGS.301-2542879.ja.html)の速度が劇的に落ちました。v13.3であれば33ミリ秒で完了する処理が13.4以降では22~33ミリ秒，つまり20~30倍の時間を要するようになりました。13.4で修正されたACI0084014（``4DLOOP``でメソッドをコールするとメモリーリークが発生する）の副作用でした。

* ACI0091008 メソッドをサーバー上でデバッグした場合，コマンドの説明文の代わりに``:xliff:...``が表示されました。

* ACI0086716 [DOMコマンド](http://doc.4d.com/4Dv14/4D/14.4/Overview-of-XML-DOM-Commands.300-2512139.ja.html)は，無効な参照が渡された場合など，システム変数```OK```に```0```が代入され，空の参照（32ビット版であれば```0000000000000000```）が返されるはずですが，```12DDB60000000000```のような中途半端で使用できない参照が返されることもありました。もっとも，システム変数```OK```には```0```が代入されます。

* ACI0093916 Windows版のみ。[Print form](http://doc.4d.com/4Dv15R2/4D/15-R2/Print-form.301-2543547.ja.html)でXPSプレビューを出力した場合，詳細マーカーの1ポイント下に配置された線オブジェクトが詳細エリアでも描画されました。直接，プリンターに出力すれば問題ありません。

* ACI0093895 ツールボックスでピクチャライブラリの画像を削除すると，``-20001``エラーが返されました。

* ACI0093873 Mac版のみ。[PRINT OPTION VALUES](http://doc.4d.com/4Dv15R2/4D/15-R2/PRINT-OPTION-VALUES.301-2543572.ja.html)の``Paper option``に返される値が逆でした。

* ACI0093774 SVG_export_to_pictureやSVG_SAVE_AS_PICTUREで保存したSVGは正しく表示されません。SVGビューア画面から保存したものは問題ありません。

* ACI0093755 ストラクチャに名前の無いリストが定義されている場合，クエリエディターと一緒にそのリストも表示されます。

* ACI0093744 Windows版のみ。空のコンボボックスをクリックするとアプリケーションがクラッシュしました。

* ACI0094103 Windows版のみ。フォントピッカーが正しくローカライズされていませんでした。ウインドウタイトルは常に『Font』であり，さらにフォントをみるためのボタンはシステム言語ではなく，4Dのローカライズ言語に基づいていました。

* ACI0093995 Windows版のみ。クイックレポートを4D Viewに出力した場合，アクセント記号付きの文字が正しく表示されませんでした。

* ACI0093983 [SMTP_SetPrefs](http://doc.4d.com/4Dv15R2/4D-Internet-Commands/15-R2/SMTP-SetPrefs.301-2666801.ja.html)および[SMTP_Charset](http://doc.4d.com/4Dv15R2/4D-Internet-Commands/15-R2/SMTP-Charset.301-2666786.ja.html)の設定に関係なく，件名は常にUTF-8でエンコードされました。

* ACI0093734 Mac版のみ。リストボックスのフッターとレコードの間，およびフッター同士の間に区切り線が表示されませんでした。

* ACI0093717 自動バックアップが『毎週日曜日』に設定されているデータベースを手動でバックアップした場合，次回のバックアップが月曜日に予定されました。

* ACI0093615 SQLの[GROUP BY](http://doc.4d.com/4Dv15R2/4D/15-R2/Using-the-GROUP-BY-clause.300-2636257.ja.html)は，WHERE句で合致するレコード数がみつからなかった場合，0件ではなく，1件を配列などに返しました。

```sql
SELECT Customer_ID,SUM(f.Total)
FROM INVOICES f  
WHERE Customer_ID = 1 
AND Customer_ID = 2  
GROUP BY Customer_ID  
INTO :$alCID,:$arTotal
```

* ACI0093535 システムの日付フォーマットが年を4桁で表示するように設定されていても，表示形式が``System date short``に設定されているリストボックスには，日付が``01/09/15``のように表示され，`` !0&9##/##/####``のような入力フィルターではセル内で日付を編集することができませんでした。

* ACI0093091 SQLでアクセント記号付きの文字（éなど）をクエリした場合に期待される結果が返されませんでした。

* ACI0093027 Windows版のみ。4D Viewで行を挿入するためのキーボードショートカット（Control+Alt+I）が効きませんでした。

* ACI0092339 SQLビューをリストボックスに表示した場合，ヘッダーに表示される列名が間違っていました。フィールドを連結したビューの代わりに``<expression>``，フィールドの別名を設定したビューは元の名前が表示されました。

```sql
CREATE or REPLACE VIEW CUSTOMERS_NY (FullName,City,Sales) 
AS SELECT CONCAT(FirstName, LastName), City, TOTAL_SALES 
FROM CUSTOMERS 
WHERE State='New York'
INTO LISTBOX:listbox;
```

* ACI0082692 [LISTBOX INSERT ROW](http://doc.4d.com/4Dv15R2/4D/15-R2/LISTBOX-INSERT-ROWS.301-2544053.ja.html)は，``On Load``で実行された場合，常に1行目に行を挿入しました。他のタイミングであれば問題ありません。代替案として[INSERT IN ARRAY](http://doc.4d.com/4Dv15R2/4D/15-R2/INSERT-IN-ARRAY.301-2543205.ja.html)または[APPEND TO ARRAY](http://doc.4d.com/4Dv15R2/4D/15-R2/APPEND-TO-ARRAY.301-2543232.ja.html)を使用することもできます。本来，``On Load``のタイミングでは，リストボックスは空であるという前提でコーディングされるべきでした。修正により，配列とリストボックスの同期メカニズムが見直され，``On Load``でも任意の場所に行が挿入できるようになりました。

* ACI0078377 リストボックスにある種の列（非表示・入力不可など）が含まれる場合，フォームエディター上でそのような列を複製すると，幅が0ピクセルの列が追加されました。プロパティリストで幅を調整しようとしても，変更できません。修正により，リストボックス列の『幅』と『非表示』の関係が明確に分けられました。

* ACI0093758 [METHOD SET CODE](http://doc.4d.com/4Dv15R2/4D/15-R2/METHOD-SET-CODE.301-2543907.ja.html)で設定されたSQLコードブロックは，正しくトークナイズされませんでした。

```
METHOD SET CODE("toto";"begin sql\rselect * from A\r end sql")
```

* ACI0093996 クイックレポートから出力したHTMLをMS Excelで開いた場合，せるデータの前に制御文字（``ESC``）が挿入されました。HTMLに改行コード（``CR``）が使用されているためです。修正により，列の名前や値は``<p>値</p>``で表現されるように改善されました。

* ACI0093885 Mac版のみ。[OBJECT SET RGB COLORS](http://doc.4d.com/4Dv15R2/4D/15-R2/OBJECT-SET-RGB-COLORS.301-2543619.ja.html)でカラーが変更されないことがありました。たとえば，フォームエディターで四角オブジェクトを作成し，任意のカラーを選択してから塗るカラーを『なし』に変更し，コマンドでカラーを変更した場合，背景色が変更されませんでした。

* ACI0093304 リストボックス行の高さが『行』単位で設定されている場合，[LISTBOX Get rows height](http://doc.4d.com/4Dv15R2/4D/15-R2/LISTBOX-Get-rows-height.301-2544043.ja.html)から返される値が正しくありませんでした。フォントサイズを変更した後，修正された行の高さが反映されませんでした。

* ACI0091153 Windows版のみ。エクスプローラーの編集モード（メソッド名などを2度クリック）の挙動が不自然でした。

* ACI0085300 アップグレードにより[接続リストボックス](http://doc.4d.com/4Dv15R2/4D/15-R2/List-box-specific-properties.300-2634737.ja.html)に変換されたグループ配列（スクロールエリア）を複製あるいはコピー・ペーストすると，フッターとヘッダーのオブジェクト名が重複しました。

* ACI0092821 アプリケーションビルドXMLプロジェクトファイルの[DataPathFile](http://doc.4d.com/4Dv15/4D/15/DataFilePath.300-2400037.ja.html)キーに相対パスを指定した場合に問題がありました。たとえば，ストラクチャファイルの名前が"application.4DC"でデータファイルの名前が"data.4DD"だった場合，データファイルがストラクチャと同じフォルダーに存在するのであれば，プロジェクトファイルは下記のようになるはずです。

```xml
<DataFilePath>data.4DD</DataFilePath>
```

しかし，実際には，初回の起動で『データファイルを作成または選択』ダイアログが表示されました。

**注記**: v11/12のドキュメントでは，POSIX相対パス，つまり"data.4DD"でストラクチャの隣にあるデータファイルが指定できる，と記述されていました。しかし，v13以降，ドキュメントはプラットフォーム特有の絶対または相対パスを指定するようにと改定されました。相対パスはWindowsが"\data.4DD"，Macが":data.4DD"と記述しなければなりません。問題は，この相対パスがアプリケーションに対して相対的だったことにあります。修正により，相対パスはストラクチャファイルに対して相対的（つまりドキュメントどおり）になりました。

* ACI0094161 変換後にフィールドが追加されたストラクチャで変換前のデータファイルを開いた場合，変換で『フィールド参照が無効です』『アドレスが無効です』などのエラーが返されました。

* ACI0085311 Mac版のみ。[PLAY](http://doc.4d.com/4Dv15R2/4D/15-R2/PLAY.301-2543166.ja.html)の非同期モードで開始したサウンドファイルの再生を下記のコマンドで停止することができませんでした。

```
PLAY("";0)
```

* ACI0093391 『[ユーザー更新可](http://doc.4d.com/4Dv15R2/4D/15-R2/User-forms.200-2634543.ja.html)』フォームのロックアイコン（エディターの右上）を解除し，プロパティリストのロックされた項目を解除してからフォームを保存しても，フォームを開き直すと元の設定に戻ってしまいました。

* ACI0093392 [EDIT FORM](http://doc.4d.com/4Dv15R2/4D/15-R2/EDIT-FORM.301-2543203.ja.html)で表示したユーザーフォームエディターは，編集が許可されているはずのプロパティ項目が表示されませんでした。

* ACI0092129 Mac版のみ。[SET PRINT PREVIEW](http://doc.4d.com/4Dv15R2/4D/15-R2/SET-PRINT-PREVIEW.301-2543565.ja.html)でプレビューが有効にされた場合，印刷ダイアログで『PDFとして保存』『PDFでメールを送信』などのオプションを選択するとアプリケーションがクラッシュしました。

* ACI0094061 テキスト入力オブジェクトのタイプを変数からフィールドに変更するたびに，オブジェクトの高さが1ずつ増えてゆきました。結果的に，自動スタイルシートもはずされてしまいました。

* ACI0094096 透過色が含まれるGIFアニメをフォームに表示した場合，画像が完全に再描画されませんでした。透過ピクセルに前の色が残されることがありました。

* ACI0094128 フォームエディターのプロパティリストで『◀︎』『▶︎』ボタンをクリックすると，オブジェクトが切り変われる代わりにBEEP音が鳴りました。

* ACI0094179 Mac版のみ。El Capitanプラットフォームでウインドウが最前面にない場合，disabled状態のボタン・チェックボックス・ラジオボタン・ポップアップメニューのテキストがenabledであるようなフォントカラーで表示されました。

* ACI0094209 データベースにパスワードを設定し，クライアント/サーバーアプリケーションをビルドした場合，ログイン画面に表示されるはずの『パスワードを保存』オプションがありませんでした。

* ACI0094214 Mac版のみ。オブジェクトメソッドを消去した場合，ウインドウの閉じるボタンが変化して，フォームが変更されたことが示されるはずですが，そうなりませんでした。

* ACI0093915 Windows版のみ｡モーダルダイアログを閉じた後，親ウインドウがアクティブになりませんでした。

* ACI0094140 プラグインAPIの``PA_CreateNativePictureForScreen``から返されたSVG画像に問題がある場合，続けて``PA_ExecuteCommandByID``を実行するとXMLエラーが返されました。

* ACI0094264 [OBJECT SET SUBFORM](http://doc.4d.com/4Dv15R2/4D/15-R2/OBJECT-SET-SUBFORM.301-2543636.ja.html)でサブフォームを切り替えた場合，直後にフォームが再描画されませんでした。[SET TIMER](http://doc.4d.com/4Dv15R2/4D/15-R2/SET-TIMER.301-2543851.ja.html)で強制的にフォームイベントを発生させれば問題ありませんでした。その場合，タイマーイベントで何がを実行する必要はありません。

* ACI0093235 変数名がUTF-8換算で63バイト以上だった場合，コンパイルできませんでした。変数名の長さ制限は31文字ですが，日本語の場合，たとえば平仮名は1文字が3バイトであるので，31文字/93バイトになることがあります。しかし，コンパイラーは，63バイトを変数名の限度としているようでした。

* ACI0093970 日本語のトークン（変数名など）が含まれるメソッドをコンパイルしてエラーが検出された場合，メッセージが文字化けしました。

![syntaxerror_v14_ok](https://cloud.githubusercontent.com/assets/10509075/11988652/942bdcaa-aa36-11e5-8aa6-cb0a518b3a1c.png)

![syntaxerror_v15_bug](https://cloud.githubusercontent.com/assets/10509075/11988653/97a5ad7a-aa36-11e5-90e5-3151d3fcb9c3.png)
