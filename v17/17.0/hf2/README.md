4D v17.0 Hotfix 2
---

![jp](https://cloud.githubusercontent.com/assets/10509075/16182979/016305e0-36e7-11e6-816b-2335cc6f0abb.png)

* ACI0098645 ``OBJECT Get style sheet``は，オブジェクトに設定されたスタイルシートではなく，スタイルシート0番を常に返しました。

* ACI0098384 配列型リストボックスの列に行の背景色配列が含まれている場合，``LISTBOX DELETE ROWS``コマンドで（最終行ではない）行を削除しようとすると，指定した行だけでなく，最終行も削除されました。

* ACI0098607 コンポーネントメソッド``WP_Switchtoolbar``が非表示に設定されていませんでした。非表示に設定されていない共有メソッドは，実行メニューに列挙されます。

---

* ACI0098518 ``FORM LOAD``コマンドでメモリにロードした4D Write Proエリアに対して``OBJECT Get font``を使用した場合，アプリケーションがクラッシュしました。

* ACI0098409 Windows 10 1803のみ。Acrobat Reader DC・ Office 365・Kyoceraのプリンタードライバをインストールし，デフォルトプリンターに設定した後，オペレーションシステムを再起動して，Microsoft Wordに続けて4Dを起動して``FONT STYLE LIST``を実行すると，しばらく後にアプリケーションがクラッシュしました。

* ACI0098547 クライアントサーバー版のみ。出力フォームにレコードを表示し，フォームをスクロールしたり，リサイズしたりするたびに，メモリーリークが発生しました。

* ACI0098506 VPN経由でサーバーに接続した状態で，30分間程度，クライアントを操作せずに放置すると，接続が失われることがありました。LANでは問題ありません。

* ACI0098515 4D Mobile/Wakanda 2.5.0のREST API経由で4Dのメソッドをコールした場合，空の戻り値が返されました。ビルド``223886``では問題ありません。ビルド``225801``の問題です。

* ACI0098481 クライアント/サーバー版のみ。ORDAの``fromCollection()``に渡されたプライマリーキーが1フィールドに相当するデータクラスに存在しない場合，新規エンティティが作成され，そのプライマリーキーには``Null``が代入されました。この場合，新規エンティティは作成されるべきではありません。

```
C_OBJECT($dataclass1;$result)
$dataclass1:=ds.IA_employee

$t1_Collection:=New collection
$t1_obj:=New object
$t1_obj.ID:=7
$t1_obj.employer:=New object()
$t1_obj.employer.ID:=10 //doesn't exist in the dataclass "IA_company"
$t1_obj.firstName:="Zoro"
$t1_Collection.push($t1_obj)
$result:=$dataclass1.fromCollection($t1_Collection)
ASSERT(Undefined($result[0].employer);"employer should not be created")
```

* ACI0098360 コレクション型のリストボックスにエンティティセレクションを表示した場合，1テーブルのリレーション属性のヘッダーをクリックすると『…属性は…データクラスに存在しません』というエラーが返され，並び替えができませんでした。``On header clicked``イベントで`` $0:=-1``を実行し，``Form.sel:=Form.sel.orderBy()``で並び替えを実行することはできますが，本来であれば，ヘッダーのクリックで自動的に実行されなければなりません。``ACI0098169``と同じ問題です。

* ACI0097954 Mac 64ビット版のみ。旧式ネットワークレイヤーでサーバーに負荷のかかる処理を続けていると，1時間ほどでアプリケーションがクラッシュしました。接続クライアント数が多ければ，それだけ短い時間で問題が発生します。

* ACI0098348 クライアント/サーバー版のみ。外部ユーザー設定ファイルが有効にされたアプリケーションで，SQLのTLSを有効にした場合，ダイアログには新しい設定が正しく表示されますが，再起動後，SQLを実行すると，接続エラーが返されました。SQLのTLSモードは，ストラクチャ設定でなければ，有効にすることができませんでした。

* ACI0098500 ランタイムエクスプローラーのプロセスリストにWebサービス（SOAP）プロセスが表示されませんでした。『一時的なコンテキストを再利用する』が有効にされていると，新規プロセスを作成する代わりに4D Mobile（REST）プロセスが再利用されました。

* ACI0098565 未定義のオブジェクト型プロパティなど，``undefined``をコンパイルモードでテキスト型に代入した場合，何も代入されませんでした。インタープリターモードのように，空の文字列が代入されるべきです。

* ACI0098546 接続中のクライアントに切断エラーのダイアログが表示された場合，以後，サーバーに対して新規クライアントを接続することができなくなりました。

* ACI0097596 Windows版のみ。Webエリアが表示されているフォームページから別にページに切り替えた場合，フォーム上のテキスト入力エリアに文字を入力することができませんでした。アプリケーションを最前面から外し，復帰した後であれば，再び入力ができるようになります。一部のWebページで問題が発生するようです。WebKit版のWebエリアでは問題が発生しません。

**注記**: 統合CEF版のWebエリアだけが修正されました。

* ACI0098624 Write Pro文書のテーブル（表組み）レンジに対し，``wk font bold``のようなテキスト属性を設定した場合，``range.start``と``range.end``の間にある文字列だけに適用されました。テーブルレンジが指定されたのであれば，テーブル全体に対して属性が適用されるべきです。

* ACI0098599 ORDAクエリの照合文字列にシングルクオート記号が含まれている場合（例：``Levi's``），クライアント/サーバーモードでエラー``1806``「正しく整形されてないURLです」が返されました。シングルユーザーモードでは問題ありません。

* ACI0098559 クライアント/サーバー版のみ。ORDAでWrite Proオブジェクトが保存されたフィールドにアクセスした場合，不完全なオブジェクトが返されました。シングルユーザー版では問題ありません。

* ACI0098507 64ビット版のみ。サーバー側で``MSG_Charset``および``MSG_GetBody``を使用した場合，特定の組み合わせ（``1;1``, ``0;1``）でアプリケーションがクラッシュしました。``MSG_Charset``を使用しなければ問題ありません。

* ACI0098406 ``LISTBOX INSERT COLUMN``の実行速度がバージョン2004から16との比較でかなり落ちました（30倍）。フッターのオブジェクト名を明示的に指定すれば，問題が発生しません。

**注記**: フッターに重複しないオブジェクト名を内部的に割り当てるため，``footer1``, ``footer2``といった具合に空いている番号がテストされていました。修正により，最後に使用された番号がキャッシュされ，その番号からテストが再開されるようになりました。結果として，列の削除によって番号が空いたとしも，その番号は再利用されないことになります。できるだけで高速に一意のオブジェクト名を割り当てることが重視されています。

* ACI0098401 リストボックス列の『自動行高』プロパティが有効にされている場合，``EDIT ITEM``や``OBJECT SET SCROLL POSITION``で目的の行まで正しくスクロールしませんでした。

* ACI0098390 ``IMPORT TEXT``またはインポートダイアログを使用して実数またはFloat型フィールドにテキストデータを読み込んだ場合，スペース記号など，数字ではない文字がデータの前後に存在すると，``0``がインポートされました。整数・倍長整数・64ビット整数では問題ありません。

* ACI0098035 Windows版のみ。リストボックスのプロパティで『行の移動』と『ドラッグ＆ドロップ』の両方が有効にされている場合，行の移動ができませんでした。

* ACI0098626 リレートフィールドに対するインデックスORDAクエリを``IN``条件で実行した場合，結果が正しくありませんでした。``IN``条件を指定しなかった場合，あるいはインデックスを使用しなかった場合は問題ありません。

* ACI0098568 背景色が透明に設定されているリストボックスの水平罫線を非表示に設定した場合，（透過プロパティによって無効化されている）リストボックスの背景色で水平罫線が描画されました。

* ACI0098564 クライアント/サーバー版のみ。無効なプライマリーキーをORDAの``dataClass.get()``に渡した場合，ローカルモードでは``null``が返されますが，クライアント/サーバーモードではエラー``1543``が返されます。

* ACI0098651 4D Mobileプロセスが再利用されることにより，散発的にアプリケーションがクラッシュしました。サーバーが4D Mobileリクエストを受信すると，データベース実行コンテキストが作成され，そのためのWebプロセスも作成されます。リクエストを処理した後，Webプロセスは再利用できる状態になります。そこで4D MobileではないWebリクエストをサーバーが受信すると，Webプロセスが再利用されます。そのプロセスを処理している間，最初に処理した4D Mobileリクエストの続きを受信すると，当初のプロセスが別のWebプロセスに再利用されているため，新規Webプロセスがそのデータベース実行コンテキストのために作成されます。その後，4D MobileではないWebリクエストの処理が完了し，しばらく使用されていないと，関連付けられたデータベース実行コンテキストが破棄されます。その後，最初に処理した4D Mobileリクエストの続きを受信すると，4D MobileではないWebリクエストを処理したプロセスが使用され，そのデータベース実行コンテキストがすでに破棄されてしまっているため，アプリケーションがクラッシュします。端的に言えば，4D Mobileを処理したWebプロセスは再利用されるべきではありません。

* ACI0098584 XMLライブラリ『xerces』がバージョン``3.2.1``にアップデートされて以来，``DOM Insert XML element``の速度が落ちました。

* ACI0098622 セレクション型のリストボックスあるいは古典的なリストフォームにエンティティ（レコード）が表示されているトランザクションのコンテキストでは，ORDAの悲観的ロックが失敗しました。さらに，トランザクション中に変更されたレコードをORDAの楽観的ロックを使用して自動マージすることもできませんでした。ORDAを使用しなければ問題ありません。同じことをORDAだけ，あるいは古典的なセレクションやSQLだけでコーディングすれば問題ありません。ORDAのロックとカレントセレクションを併用した場合に問題が発生します。

* ACI0098567 エンティティセレクションに対して``count()``コレクションメソッドを使用すると，アプリケーションがクラッシュしました。確かにエンティティセレクションはオブジェクトであり，コレクションではありませんが，だとしても，クラッシュするのではなく，シンタックスエラーのダイアログを表示するべきです。

* ACI0098569 フォームオブジェクトの『変数または式』に``TheString+":"``のようなフォーミュラが設定されている場合，`` OBJECT GET BEST SIZE``は評価されたテキストに基づいて正確な値を返しませんでした。``TheString``のような単純な変数であれば問題ありません。

* ACI0098677 フランス語版のみ。関数のパラメーターを省略した場合（例：``function (;;)``）コンパイラーに空のエラーメッセージが表示されました。

* ACI0098657 4D Serverに対して200ユーザーを接続するのに20分を要しました。

**注記**: 接続に要する時間を短縮するために，管理画面を非表示することが勧められています。

* ACI0098405 ``Open Window``あるいは``Open form window``で開いたウィンドウに表示された文字列を``MESSAGE``コマンドで更新することができませんでした。

* ACI0098102 ``DIALOG``コマンドでWebエリアが配置されたフォームを別ウィンドウに表示した場合，そのフォームで``CANCEL``コマンドを使用すると，呼び出し元のダイアログが閉じられました。フォームメソッドでWebエリアのURL変数にアドレスを代入すれば問題ありません。また，別ウィンドウのダイアログを表示する直前にブレークポイントを挿入すれば，問題は再現しません。

* ACI0098054 共有コレクションに共有オブジェクトを追加し，``Use``/``End use``構文の中でその共有オブジェクトをロックした状態で``New process``を使用して起動したプロセスをデバッグしようとすると，デバッガウィンドウがフリーズしました。

* ACI0098579 コンパイルモードでピクチャに対する逆参照されたポインターに対して``Null``を代入することができませんでした。

* ACI0098511 クライアント/サーバー版のみ。コレクション型のリストボックスをダブルクリックし，切り替わった詳細フォームでレコードを編集して元のフォームに復帰した場合，更新された値がリストボックスに反映されませんでした。セレクション型のリストボックスでは問題ありません。

* ACI0087085 外部アプリケーションから``tab``コードが含まれる文字列をメソッドエディターにドラッグ＆ドロップあるいはコピー＆ペーストすると，``tab``文字が無視されました。

**注記**: 修正により，文字列リテラルに挿入された``tab``コードなどの文字は``\t``のようなシーケンスにエスケープされるようになりました。

* ACI0098642 ``IMPORT TEXT``コマンドでテキスト型のフィールドに値をインポートした場合，文字列の前後にあるスペース文字が切り捨てられました。

* ACI0098538 クライアント/サーバー版のみ。``newEntity()``で作成したエンティティの属性は，すべて``Null``でした。タイプに応じたデフォルト値がセットされるべきです。

* ACI0098399 Mac 32ビット版のみ。大量（例：３時間で19万件）のSOAPリクエストを処理すると，サーバーがクラッシュすることがありました。ACI0097539とは別の問題です。管理画面を表示した状態で放置すれば，より短時間でアプリケーションがクラッシュします。

* ACI0098343 Windows版のみ。添付ファイルの名前にウムラウトが含まれる場合，``MSG_Charset(1;1) ``設定の``MSG_Extract``で作成されるファイル名が正しくありませんでした。

* ACI0098526 ORDAでNフィールドに相当するリレーション属性を更新しようとすると，指定した値ではなく，``Null``が代入されました。値を確認して，もう一度，同じ値を代入すれば，今度は成功します。あるいは，値を代入する代わりに，1レコードに相当するエンティティを代入すれば，問題を回避することができます。

* ACI0098522 標準アクションを使用してカレントレコードを移動すると，別ページに配置されたプラグインエリアに対してもレコードがロードされたというイベントが配信されました。カレントページのアクティブなエリアだけがイベントを受け取るべきです。

* ACI0098497 4D Serverのデータベース設定ダイアログに``2048 MB``以上のキャッシュサイズを入力して『適用』ボタンをクリックした場合，キャッシュサイズが正しく設定されませんでした。``SET CACHE SIZE``であれば問題ありません。

* ACI0098430 『デザインモードを検索』ダイアログの『タイプ』ポップアップメニューで『プラグインコマンド』を選択した後，『名前』を『等しい』から別の値に変更しようとすると，ダイアログが閉じられました。

* ACI0098620 ``PA_Get4DVersion``をプリエンプティブモードで使用することができませんでした。

* ACI0098619 ``PA_SetBlobParameter``をプリエンプティブモードで使用することができませんでした。

* ACI0098551 Windows 64ビット版のみ。``ntdll.dll``モジュールが原因でアプリケーションがクラッシュすることがありました。
